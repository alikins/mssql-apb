FROM ansibleplaybookbundle/apb-base

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN yum -y install --setopt=tsflags=nodocs python-pip && \
    pip install --upgrade pip && \
    pip install pymssql && \
    yum clean all && \
    chmod -R g=u /opt/{ansible,apb}
USER apb

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG1zc3FsLXNlcnZlci1hcGIKZGVzY3JpcHRpb246IEFQQiB0byBk\
ZXBsb3kgU1FMIFNlcnZlciBvbiBMaW51eApiaW5kYWJsZTogVHJ1ZQphc3luYzogb3B0aW9uYWwK\
bWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6IFNRTCBTZXJ2ZXIgb24gTGludXggKEFQQikKICBpbWFn\
ZVVybDogaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3RjaHVnaGVzaXYvbXNzcWwt\
c2VydmVyLWFwYi9tYXN0ZXIvZG9jcy9pbWcvc3FsLXNlcnZlci5wbmcKICBkb2N1bWVudGF0aW9u\
VXJsOiBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9zcWwvbGludXgvc3FsLXNlcnZl\
ci1saW51eC1vdmVydmlldwogIHNlcnZpY2VOYW1lOiBtc3NxbC1zZXJ2ZXIKICBkZXBlbmRlbmNp\
ZXM6IFsnZG9ja2VyLmlvL3RjaHVnaGVzaXYvbXNzcWwtc2VydmVyLWxpbnV4J10KdGFnczoKICAt\
IGRhdGFiYXNlCnBsYW5zOgogIC0gbmFtZTogZXBoZW1lcmFsCiAgICBkZXNjcmlwdGlvbjogVGhp\
cyBwbGFuIGRlcGxveXMgYW4gZXBoZW1lcmFsIG1zc3FsLXNlcnZlci4KICAgIGZyZWU6IFRydWUK\
ICAgIGRlZmF1bHQ6IFRydWUKICAgIG1ldGFkYXRhOgogICAgICBkaXNwbGF5TmFtZTogRXBoZW1l\
cmFsIGluc3RhbGxhdGlvbgogICAgICBsb25nRGVzY3JpcHRpb246IFRoaXMgcGxhbiB3aWxsIGRl\
cGxveSBhIE1TIFNRTCBTZXJ2ZXIgc3RhbmRhbG9uZSB1c2luZyBlcGhlbWVyYWwgc3RvcmFnZQog\
ICAgcGFyYW1ldGVyczoKICAgICAgLSBuYW1lOiBNU1NRTF9QQVNTV09SRAogICAgICAgIHJlcXVp\
cmVkOiBUcnVlCiAgICAgICAgZGVmYXVsdDogInlvdXJTdHJvbmdAUGFzc3dvcmQiCiAgICAgICAg\
cGF0dGVybjogIl5bYS16QS1aMC05Xy4tXSokIgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAg\
IGRpc3BsYXlfdHlwZTogcGFzc3dvcmQKICAgICAgICB0aXRsZTogIlBhc3N3b3JkIGZvciB0aGUg\
ZGF0YWJhc2UgYWRtaW4gdXNlci4iCiAgICAgICAgZGVzY3JpcHRpb246ICJUaGUgcGFzc3dvcmQg\
c2hvdWxkIGZvbGxvdyB0aGUgU1FMIFNlcnZlciBkZWZhdWx0IHBhc3N3b3JkIHBvbGljeSwgb3Ro\
ZXJ3aXNlIHRoZSBjb250YWluZXIgY2FuIG5vdCBzZXR1cCBTUUwgc2VydmVyIGFuZCB3aWxsIHN0\
b3Agd29ya2luZy4gQnkgZGVmYXVsdCwgdGhlIHBhc3N3b3JkIG11c3QgYmUgYXQgbGVhc3QgOCBj\
aGFyYWN0ZXJzIGxvbmcgYW5kIGNvbnRhaW4gY2hhcmFjdGVycyBmcm9tIHRocmVlIG9mIHRoZSBm\
b2xsb3dpbmcgZm91ciBzZXRzOiBVcHBlcmNhc2UgbGV0dGVycywgTG93ZXJjYXNlIGxldHRlcnMs\
IEJhc2UgMTAgZGlnaXRzLCBhbmQgU3ltYm9scy4gWW91IGNhbiBleGFtaW5lIHRoZSBlcnJvciBs\
b2cgYnkgZXhlY3V0aW5nIHRoZSBkb2NrZXIgbG9ncyBjb21tYW5kLiIKICAgICAgICBkaXNwbGF5\
X2dyb3VwOiBNUyBTUUwgQ29uZmlnCiAgICAgIC0gbmFtZTogTVNTUUxfREFUQUJBU0UKICAgICAg\
ICByZXF1aXJlZDogVHJ1ZQogICAgICAgIGRlZmF1bHQ6IHNhbXBsZWRiCiAgICAgICAgcGF0dGVy\
bjogIl5bYS16QS1aMC05Xy1dKiQiCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgdGl0bGU6\
IE5hbWUgb2YgdGhlIE1TIFNRTCBkYXRhYmFzZSBhY2Nlc3NlZAogICAgICAgIGRpc3BsYXlfZ3Jv\
dXA6IE1TIFNRTCBDb25maWcKICAgICAgLSBuYW1lOiBNU1NRTF9NRU1PUllfTElNSVQKICAgICAg\
ICBkZWZhdWx0OiAyR2kKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTogTWF4aW11\
bSBhbW91bnQgb2YgbWVtb3J5IHRoZSBjb250YWluZXIgY2FuIHVzZSBlZyA1MTJNaSAxR2kKICAg\
ICAgICBkaXNwbGF5X2dyb3VwOiBFbnZpcm9ubWVudCBTaXppbmcKICAgICAgLSBuYW1lOiBNU1NR\
TF9NRU1PUllfUkVRVUVTVAogICAgICAgIGRlZmF1bHQ6IDFHaQogICAgICAgIHR5cGU6IHN0cmlu\
ZwogICAgICAgIHRpdGxlOiBSZXF1ZXN0ZWQgYW1vdW50IG9mIG1lbW9yeSBmb3IgdGhlIGNvbnRh\
aW5lciB0byBzdGFydCBlZyAxR2kgMkdpCiAgICAgICAgZGlzcGxheV9ncm91cDogRW52aXJvbm1l\
bnQgU2l6aW5nCg=="
