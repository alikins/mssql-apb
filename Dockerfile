FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"LS0tCnZlcnNpb246IDEuMApuYW1lOiBtc3NxbC1hcGIKZGVzY3JpcHRpb246IEFQQiB0byBkZXBs\
b3kgU1FMIFNlcnZlciBvbiBMaW51eApiaW5kYWJsZTogdHJ1ZQphc3luYzogb3B0aW9uYWwKbWV0\
YWRhdGE6CiAgZGlzcGxheU5hbWU6IFNRTCBTZXJ2ZXIgb24gTGludXggKEFQQikKICBpbWFnZVVy\
bDoKICAgIGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9hbnNpYmxlcGxheWJvb2ti\
dW5kbGUvbXNzcWwtYXBiL21hc3Rlci9kb2NzL2ltZy9zcWwtc2VydmVyLnBuZwogIGRvY3VtZW50\
YXRpb25Vcmw6CiAgICBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9zcWwvbGludXgv\
c3FsLXNlcnZlci1saW51eC1vdmVydmlldwogIHNlcnZpY2VOYW1lOiBtc3NxbC1zZXJ2ZXIKICBk\
ZXBlbmRlbmNpZXM6IFsnZG9ja2VyLmlvL3RjaHVnaGVzaXYvbXNzcWwtc2VydmVyLWxpbnV4J10K\
dGFnczoKICAtIGRhdGFiYXNlCnBsYW5zOgogIC0gbmFtZTogZXBoZW1lcmFsCiAgICBkZXNjcmlw\
dGlvbjogVGhpcyBwbGFuIGRlcGxveXMgYW4gZXBoZW1lcmFsIG1zc3FsLXNlcnZlci4KICAgIGZy\
ZWU6IHRydWUKICAgIGRlZmF1bHQ6IHRydWUKICAgIG1ldGFkYXRhOgogICAgICBkaXNwbGF5TmFt\
ZTogRXBoZW1lcmFsIGluc3RhbGxhdGlvbgogICAgICBsb25nRGVzY3JpcHRpb246CiAgICAgICAg\
VGhpcyBwbGFuIHdpbGwgZGVwbG95IGEgTVMgU1FMIFNlcnZlciBvbiBMaW51eCBzdGFuZGFsb25l\
CiAgICAgICAgdXNpbmcgZXBoZW1lcmFsIHN0b3JhZ2UKICAgIHBhcmFtZXRlcnM6CiAgICAgIC0g\
bmFtZTogTVNTUUxfUEFTU1dPUkQKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1\
bHQ6ICJ5b3VyU3Ryb25nQFBhc3N3b3JkIgogICAgICAgIHBhdHRlcm46ICJeW2EtekEtWjAtOSFA\
IyQlXiYqKz1dezgsfSQiCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGlzcGxheV90eXBl\
OiBwYXNzd29yZAogICAgICAgIHRpdGxlOiAiUGFzc3dvcmQgZm9yIHRoZSBkYXRhYmFzZSBhZG1p\
biAoU0EpIHVzZXIuIgogICAgICAgIGRlc2NyaXB0aW9uOgogICAgICAgICAgIlRoZSBwYXNzd29y\
ZCBtdXN0IGJlIGF0IGxlYXN0IDggY2hhcmFjdGVycyBsb25nIGFuZCBjb250YWluCiAgICAgICAg\
ICBjaGFyYWN0ZXJzIGZyb20gdGhyZWUgb2YgdGhlIGZvbGxvd2luZyBmb3VyIHNldHM6IFVwcGVy\
Y2FzZQogICAgICAgICAgbGV0dGVycywgTG93ZXJjYXNlIGxldHRlcnMsIEJhc2UgMTAgZGlnaXRz\
LCBhbmQgU3ltYm9scy4gWW91CiAgICAgICAgICBjYW4gZXhhbWluZSB0aGUgZXJyb3IgbG9nIGJ5\
IGV4ZWN1dGluZyB0aGUgZG9ja2VyIGxvZ3MgY29tbWFuZC4iCiAgICAgICAgZGlzcGxheV9ncm91\
cDogTVMgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1TU1FMX0RBVEFCQVNFCiAgICAgICAgcmVx\
dWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiBzYW1wbGVkYgogICAgICAgIHBhdHRlcm46ICJe\
W2EtekEtWjAtOV8tXSokIgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHRpdGxlOiBOYW1l\
IG9mIHRoZSBNUyBTUUwgZGF0YWJhc2UgYWNjZXNzZWQKICAgICAgICBkaXNwbGF5X2dyb3VwOiBN\
UyBTUUwgQ29uZmlnCiAgICAgIC0gbmFtZTogTVNTUUxfTUVNT1JZX0xJTUlUCiAgICAgICAgZGVm\
YXVsdDogMkdpCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgdGl0bGU6IE1heGltdW0gYW1v\
dW50IG9mIG1lbW9yeSB0aGUgY29udGFpbmVyIGNhbiB1c2UgZWcgNTEyTWkgMUdpCiAgICAgICAg\
ZGlzcGxheV9ncm91cDogRW52aXJvbm1lbnQgU2l6aW5nCiAgICAgIC0gbmFtZTogTVNTUUxfTUVN\
T1JZX1JFUVVFU1QKICAgICAgICBkZWZhdWx0OiAxR2kKICAgICAgICB0eXBlOiBzdHJpbmcKICAg\
ICAgICB0aXRsZTogUmVxdWVzdGVkIGFtb3VudCBvZiBtZW1vcnkgZm9yIHRoZSBjb250YWluZXIg\
dG8gc3RhcnQgZWcgMUdpIDJHaQogICAgICAgIGRpc3BsYXlfZ3JvdXA6IEVudmlyb25tZW50IFNp\
emluZwo="

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN yum -y install --setopt=tsflags=nodocs python-pip && \
    yum clean all && \
    chown -R 0 /opt/{ansible,apb} && \
    pip install --upgrade pip && \
    pip install pymssql && \
    chown -R apb:0 /opt/{ansible,apb} && \
    chmod -R g=u /opt/{ansible,apb}
USER apb
