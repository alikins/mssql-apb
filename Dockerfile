FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"LS0tCnZlcnNpb246IDEuMApuYW1lOiBtc3NxbC1hcGIKZGVzY3JpcHRpb246IERlcGxveW1lbnQg\
b2YgTWljcm9zb2Z0IFNRTCBTZXJ2ZXIgb24gTGludXgKYmluZGFibGU6IHRydWUKYXN5bmM6IG9w\
dGlvbmFsCm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiBNaWNyb3NvZnQgU1FMIFNlcnZlciBvbiBM\
aW51eAogIGltYWdlVXJsOgogICAgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2Fu\
c2libGVwbGF5Ym9va2J1bmRsZS9tc3NxbC1hcGIvbWFzdGVyL2RvY3MvaW1nL3NxbC1zZXJ2ZXIu\
cG5nCiAgZG9jdW1lbnRhdGlvblVybDoKICAgIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL2Vu\
LXVzL3NxbC9saW51eC9zcWwtc2VydmVyLWxpbnV4LW92ZXJ2aWV3CiAgZGVwZW5kZW5jaWVzOiBb\
J2RvY2tlci5pby90Y2h1Z2hlc2l2L21zc3FsLXNlcnZlci1saW51eCddCnRhZ3M6CiAgLSBkYXRh\
YmFzZQogIC0gbXNzcWwKcGxhbnM6CiAgLSBuYW1lOiBlcGhlbWVyYWwKICAgIGRlc2NyaXB0aW9u\
OiBUaGlzIHBsYW4gZGVwbG95cyBhbiBlcGhlbWVyYWwgTWljcm9zb2Z0IFNRTCBTZXJ2ZXIgb24g\
TGludXguCiAgICBmcmVlOiB0cnVlCiAgICBkZWZhdWx0OiB0cnVlCiAgICBtZXRhZGF0YToKICAg\
ICAgZGlzcGxheU5hbWU6IEVwaGVtZXJhbCBpbnN0YWxsYXRpb24KICAgICAgbG9uZ0Rlc2NyaXB0\
aW9uOgogICAgICAgIFRoaXMgcGxhbiB3aWxsIGRlcGxveSBhIHN0YW5kYWxvbmUgTWljcm9zb2Z0\
IFNRTCBTZXJ2ZXIgb24gTGludXgKICAgICAgICB1c2luZyBlcGhlbWVyYWwgc3RvcmFnZQogICAg\
cGFyYW1ldGVyczoKICAgICAgLSBuYW1lOiBBQ0NFUFRfRVVMQQogICAgICAgIHRpdGxlOiBBY2Nl\
cHQgdGhlIEVuZC1Vc2VyIExpY2Vuc2luZyBBZ3JlZW1lbnQuCiAgICAgICAgdHlwZTogYm9vbGVh\
bgogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogZmFsc2UKICAgICAgICBk\
ZXNjcmlwdGlvbjogaHR0cDovL2dvLm1pY3Jvc29mdC5jb20vZndsaW5rLz9MaW5rSWQ9NzQ2Mzg4\
CiAgICAgICAgZGlzcGxheV9ncm91cDogRVVMQSBSZXF1aXJlZAogICAgICAtIG5hbWU6IE1TU1FM\
X1BBU1NXT1JECiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiAiSGVsbG8x\
MjMhIgogICAgICAgIHBhdHRlcm46ICJeKD86KD86W2Etel0rLipbQS1aXSsuKihcXGR8XFxXKSsu\
KilcCiAgICAgICAgICB8KD86W0EtWl0rLipbYS16XSsuKihcXGR8XFxXKSsuKilcCiAgICAgICAg\
ICB8KD86KFxcZHxcXFcpKy4qW2Etel0uKltBLVpdLiopfCg/OihcXGR8XFxXKSsuKltBLVpdKy4q\
W2Etel0rLiopXAogICAgICAgICAgfCg/OltBLVpdKy4qKFxcZHxcXFcpKy4qW2Etel0rLiopfCg/\
OlthLXpdKy4qKFxcZHxcXFcpKy4qW0EtWl0rLiopXAogICAgICAgICAgfCg/OlxcZCsuKlxcVysu\
KihbQS1aXXxbYS16XSkrLiopfCg/OlxcVysuKlxcZCsuKihbQS1aXXxbYS16XSkrLiopXAogICAg\
ICAgICAgfCg/OihbQS1aXXxbYS16XSkrLipcXGQrLipcXFcrLiopfCg/OihbQS1aXXxbYS16XSkr\
LipcXFcrLipcXGQrLiopXAogICAgICAgICAgfCg/OlxcVysuKihbQS1aXXxbYS16XSkrLipcXGQr\
LiopfCg/OlxcZCsuKihbQS1aXXxbYS16XSkrLipcXFcrLiopKSQiCiAgICAgICAgdHlwZTogc3Ry\
aW5nCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICAgIHRpdGxlOiAiUGFzc3dv\
cmQgZm9yIHRoZSBkYXRhYmFzZSBhZG1pbiAoU0EpIHVzZXIuIgogICAgICAgIGRlc2NyaXB0aW9u\
OgogICAgICAgICAgIlRoZSBwYXNzd29yZCBtdXN0IGJlIGF0IGxlYXN0IDggY2hhcmFjdGVycyBs\
b25nIGFuZCBjb250YWluCiAgICAgICAgICBjaGFyYWN0ZXJzIGZyb20gdGhyZWUgb2YgdGhlIGZv\
bGxvd2luZyBmb3VyIHNldHM6IFVwcGVyY2FzZQogICAgICAgICAgbGV0dGVycywgTG93ZXJjYXNl\
IGxldHRlcnMsIEJhc2UgMTAgZGlnaXRzLCBhbmQgU3ltYm9scy4iCiAgICAgICAgZGlzcGxheV9n\
cm91cDogTWljcm9zb2Z0IFNRTCBDb25maWcKICAgICAgICBtaW5fbGVuZ3RoOiA4CiAgICAgICAg\
bWF4X2xlbmd0aDogMTI4CiAgICAgIC0gbmFtZTogTVNTUUxfREFUQUJBU0UKICAgICAgICByZXF1\
aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IFRlc3REQgogICAgICAgIHBhdHRlcm46ICJeW2Et\
ekEtWjAtOV8tXSokIgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHRpdGxlOiBOYW1lIG9m\
IHRoZSBNaWNyb3NvZnQgU1FMIGRhdGFiYXNlIHRvIGNyZWF0ZS4KICAgICAgICBkaXNwbGF5X2dy\
b3VwOiBNaWNyb3NvZnQgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1TU1FMX0FHRU5UX0VOQUJM\
RUQKICAgICAgICB0aXRsZTogRW5hYmxlIFNRTCBTZXJ2ZXIgQWdlbnQuCiAgICAgICAgdHlwZTog\
Ym9vbGVhbgogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogZmFsc2UKICAg\
ICAgICBkaXNwbGF5X2dyb3VwOiBNaWNyb3NvZnQgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1T\
U1FMX1BJRAogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgdHlwZTogZW51bQogICAgICAg\
IGVudW06IFsnRGV2ZWxvcGVyJywgJ0V2YWx1YXRpb24nXQogICAgICAgIGRlZmF1bHQ6IERldmVs\
b3BlcgogICAgICAgIHRpdGxlOiBTZXQgdGhlIFNRTCBTZXJ2ZXIgZWRpdGlvbi4KICAgICAgICBk\
aXNwbGF5X2dyb3VwOiBNaWNyb3NvZnQgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1TU1FMX0xP\
Q0FMX0lTCiAgICAgICAgdGl0bGU6IFVzZSBleGlzdGluZyBtc3NxbC1zZXJ2ZXItbGludXggaW1h\
Z2VzdHJlYW0gaW4gcHJvamVjdC4KICAgICAgICB0eXBlOiBib29sZWFuCiAgICAgICAgcmVxdWly\
ZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiBmYWxzZQogICAgICAgIGRpc3BsYXlfZ3JvdXA6IE1p\
Y3Jvc29mdCBTUUwgQ29uZmlnCiAgICAgIC0gbmFtZTogTVNTUUxfTENJRAogICAgICAgIHRpdGxl\
OiBTZXQgdGhlIGxhbmd1YWdlIElELgogICAgICAgIHR5cGU6IGludGVnZXIKICAgICAgICByZXF1\
aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IDEwMzMKICAgICAgICBkZXNjcmlwdGlvbjogRm9y\
IGV4YW1wbGUgLSAxMDMzIGlzIEVuZ2xpc2ggKFVTKSwgMTAzNiBpcyBGcmVuY2guCiAgICAgICAg\
bWluX2xlbmd0aDogNAogICAgICAgIG1heF9sZW5ndGg6IDQKICAgICAgICBkaXNwbGF5X2dyb3Vw\
OiBNaWNyb3NvZnQgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1TU1FMX0lNQUdFX1BVTEwKICAg\
ICAgICB0aXRsZTogIkRlcGxveW1lbnRDb25maWcgSW1hZ2UgcHVsbCBwb2xpY3kiCiAgICAgICAg\
dHlwZTogZW51bQogICAgICAgIGVudW06IFsnQWx3YXlzJywgJ0lmTm90UHJlc2VudCcsICdOZXZl\
ciddCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiBJZk5vdFByZXNlbnQK\
ICAgICAgICBkaXNwbGF5X2dyb3VwOiBNaWNyb3NvZnQgU1FMIENvbmZpZwogICAgICAtIG5hbWU6\
IE1TU1FMX01FTU9SWV9MSU1JVAogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVs\
dDogMwogICAgICAgIHR5cGU6IGludGVnZXIKICAgICAgICB0aXRsZToKICAgICAgICAgIE1heGlt\
dW0gYW1vdW50IG9mIG1lbW9yeSB0aGUgY29udGFpbmVyIGNhbiB1c2UgKGluIEdCKSBlZyAxR0Ig\
MkdCCiAgICAgICAgZGlzcGxheV9ncm91cDogRW52aXJvbm1lbnQgU2l6aW5nCiAgICAgIC0gbmFt\
ZTogTVNTUUxfTUVNT1JZX1JFUVVFU1QKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRl\
ZmF1bHQ6IDIKICAgICAgICB0eXBlOiBpbnRlZ2VyCiAgICAgICAgdGl0bGU6CiAgICAgICAgICBS\
ZXF1ZXN0ZWQgYW1vdW50IG9mIG1lbW9yeSBmb3IgdGhlIGNvbnRhaW5lciB0byBzdGFydCAoaW4g\
R0IpCiAgICAgICAgICBlZyAxR0IgMkdCCiAgICAgICAgZGlzcGxheV9ncm91cDogRW52aXJvbm1l\
bnQgU2l6aW5nCgogIC0gbmFtZTogcGVyc2lzdGVudAogICAgZGVzY3JpcHRpb246IFRoaXMgcGxh\
biBkZXBsb3lzIGEgcGVyc2lzdGVudCBNaWNyb3NvZnQgU1FMIFNlcnZlciBvbiBMaW51eC4KICAg\
IGZyZWU6IHRydWUKICAgIG1ldGFkYXRhOgogICAgICBkaXNwbGF5TmFtZTogUGVyc2lzdGVudCBp\
bnN0YWxsYXRpb24KICAgICAgbG9uZ0Rlc2NyaXB0aW9uOgogICAgICAgIFRoaXMgcGxhbiB3aWxs\
IGRlcGxveSBhIHN0YW5kYWxvbmUgTWljcm9zb2Z0IFNRTCBTZXJ2ZXIgb24gTGludXgKICAgICAg\
ICB1c2luZyBwZXJzaXN0ZW50IHN0b3JhZ2UKICAgIHBhcmFtZXRlcnM6CiAgICAgIC0gbmFtZTog\
QUNDRVBUX0VVTEEKICAgICAgICB0aXRsZTogQWNjZXB0IHRoZSBFbmQtVXNlciBMaWNlbnNpbmcg\
QWdyZWVtZW50LgogICAgICAgIHR5cGU6IGJvb2xlYW4KICAgICAgICByZXF1aXJlZDogdHJ1ZQog\
ICAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICAgICAgZGVzY3JpcHRpb246IGh0dHA6Ly9nby5taWNy\
b3NvZnQuY29tL2Z3bGluay8/TGlua0lkPTc0NjM4OAogICAgICAgIGRpc3BsYXlfZ3JvdXA6IEVV\
TEEgUmVxdWlyZWQKICAgICAgLSBuYW1lOiBNU1NRTF9QQVNTV09SRAogICAgICAgIHJlcXVpcmVk\
OiB0cnVlCiAgICAgICAgZGVmYXVsdDogIkhlbGxvMTIzISIKICAgICAgICBwYXR0ZXJuOiAiXig/\
Oig/OlthLXpdKy4qW0EtWl0rLiooXFxkfFxcVykrLiopXAogICAgICAgICAgfCg/OltBLVpdKy4q\
W2Etel0rLiooXFxkfFxcVykrLiopXAogICAgICAgICAgfCg/OihcXGR8XFxXKSsuKlthLXpdLipb\
QS1aXS4qKXwoPzooXFxkfFxcVykrLipbQS1aXSsuKlthLXpdKy4qKVwKICAgICAgICAgIHwoPzpb\
QS1aXSsuKihcXGR8XFxXKSsuKlthLXpdKy4qKXwoPzpbYS16XSsuKihcXGR8XFxXKSsuKltBLVpd\
Ky4qKVwKICAgICAgICAgIHwoPzpcXGQrLipcXFcrLiooW0EtWl18W2Etel0pKy4qKXwoPzpcXFcr\
LipcXGQrLiooW0EtWl18W2Etel0pKy4qKVwKICAgICAgICAgIHwoPzooW0EtWl18W2Etel0pKy4q\
XFxkKy4qXFxXKy4qKXwoPzooW0EtWl18W2Etel0pKy4qXFxXKy4qXFxkKy4qKVwKICAgICAgICAg\
IHwoPzpcXFcrLiooW0EtWl18W2Etel0pKy4qXFxkKy4qKXwoPzpcXGQrLiooW0EtWl18W2Etel0p\
Ky4qXFxXKy4qKSkkIgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIGRpc3BsYXlfdHlwZTog\
cGFzc3dvcmQKICAgICAgICB0aXRsZTogIlBhc3N3b3JkIGZvciB0aGUgZGF0YWJhc2UgYWRtaW4g\
KFNBKSB1c2VyLiIKICAgICAgICBkZXNjcmlwdGlvbjoKICAgICAgICAgICJUaGUgcGFzc3dvcmQg\
bXVzdCBiZSBhdCBsZWFzdCA4IGNoYXJhY3RlcnMgbG9uZyBhbmQgY29udGFpbgogICAgICAgICAg\
Y2hhcmFjdGVycyBmcm9tIHRocmVlIG9mIHRoZSBmb2xsb3dpbmcgZm91ciBzZXRzOiBVcHBlcmNh\
c2UKICAgICAgICAgIGxldHRlcnMsIExvd2VyY2FzZSBsZXR0ZXJzLCBCYXNlIDEwIGRpZ2l0cywg\
YW5kIFN5bWJvbHMuIgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IE1pY3Jvc29mdCBTUUwgQ29uZmln\
CiAgICAgICAgbWluX2xlbmd0aDogOAogICAgICAgIG1heF9sZW5ndGg6IDEyOAogICAgICAtIG5h\
bWU6IE1TU1FMX0RBVEFCQVNFCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0\
OiBUZXN0REIKICAgICAgICBwYXR0ZXJuOiAiXlthLXpBLVowLTlfLV0qJCIKICAgICAgICB0eXBl\
OiBzdHJpbmcKICAgICAgICB0aXRsZTogTmFtZSBvZiB0aGUgTWljcm9zb2Z0IFNRTCBkYXRhYmFz\
ZSB0byBjcmVhdGUuCiAgICAgICAgZGlzcGxheV9ncm91cDogTWljcm9zb2Z0IFNRTCBDb25maWcK\
ICAgICAgLSBuYW1lOiBNU1NRTF9BR0VOVF9FTkFCTEVECiAgICAgICAgdGl0bGU6IEVuYWJsZSBT\
UUwgU2VydmVyIEFnZW50LgogICAgICAgIHR5cGU6IGJvb2xlYW4KICAgICAgICByZXF1aXJlZDog\
dHJ1ZQogICAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICAgICAgZGlzcGxheV9ncm91cDogTWljcm9z\
b2Z0IFNRTCBDb25maWcKICAgICAgLSBuYW1lOiBNU1NRTF9QSUQKICAgICAgICByZXF1aXJlZDog\
dHJ1ZQogICAgICAgIHR5cGU6IGVudW0KICAgICAgICBlbnVtOiBbJ0RldmVsb3BlcicsICdFdmFs\
dWF0aW9uJ10KICAgICAgICBkZWZhdWx0OiBEZXZlbG9wZXIKICAgICAgICB0aXRsZTogU2V0IHRo\
ZSBTUUwgU2VydmVyIGVkaXRpb24uCiAgICAgICAgZGlzcGxheV9ncm91cDogTWljcm9zb2Z0IFNR\
TCBDb25maWcKICAgICAgLSBuYW1lOiBNU1NRTF9MT0NBTF9JUwogICAgICAgIHRpdGxlOiBVc2Ug\
ZXhpc3RpbmcgbXNzcWwtc2VydmVyLWxpbnV4IGltYWdlc3RyZWFtIGluIHByb2plY3QuCiAgICAg\
ICAgdHlwZTogYm9vbGVhbgogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDog\
ZmFsc2UKICAgICAgICBkaXNwbGF5X2dyb3VwOiBNaWNyb3NvZnQgU1FMIENvbmZpZwogICAgICAt\
IG5hbWU6IE1TU1FMX0xDSUQKICAgICAgICB0aXRsZTogU2V0IHRoZSBsYW5ndWFnZSBJRC4KICAg\
ICAgICB0eXBlOiBpbnRlZ2VyCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0\
OiAxMDMzCiAgICAgICAgZGVzY3JpcHRpb246IEZvciBleGFtcGxlIC0gMTAzMyBpcyBFbmdsaXNo\
IChVUyksIDEwMzYgaXMgRnJlbmNoLgogICAgICAgIG1pbl9sZW5ndGg6IDQKICAgICAgICBtYXhf\
bGVuZ3RoOiA0CiAgICAgICAgZGlzcGxheV9ncm91cDogTWljcm9zb2Z0IFNRTCBDb25maWcKICAg\
ICAgLSBuYW1lOiBNU1NRTF9JTUFHRV9QVUxMCiAgICAgICAgdGl0bGU6ICJEZXBsb3ltZW50Q29u\
ZmlnIEltYWdlIHB1bGwgcG9saWN5IgogICAgICAgIHR5cGU6IGVudW0KICAgICAgICBlbnVtOiBb\
J0Fsd2F5cycsICdJZk5vdFByZXNlbnQnLCAnTmV2ZXInXQogICAgICAgIHJlcXVpcmVkOiB0cnVl\
CiAgICAgICAgZGVmYXVsdDogSWZOb3RQcmVzZW50CiAgICAgICAgZGlzcGxheV9ncm91cDogTWlj\
cm9zb2Z0IFNRTCBDb25maWcKICAgICAgLSBuYW1lOiBNU1NRTF9EQVRBX1NUT1JBR0VfU0laRQog\
ICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogMQogICAgICAgIHR5cGU6IGlu\
dGVnZXIKICAgICAgICB0aXRsZTogUGVyc2lzdGVudCB2b2x1bWUgc2l6ZSBmb3IgZGIgZGF0YSAo\
aW4gR0IpIGVnIDFHQiAyR0IKICAgICAgICBkaXNwbGF5X2dyb3VwOiBFbnZpcm9ubWVudCBTaXpp\
bmcKICAgICAgLSBuYW1lOiBNU1NRTF9NRU1PUllfTElNSVQKICAgICAgICByZXF1aXJlZDogdHJ1\
ZQogICAgICAgIGRlZmF1bHQ6IDMKICAgICAgICB0eXBlOiBpbnRlZ2VyCiAgICAgICAgdGl0bGU6\
CiAgICAgICAgICBNYXhpbXVtIGFtb3VudCBvZiBtZW1vcnkgdGhlIGNvbnRhaW5lciBjYW4gdXNl\
IChpbiBHQikgZWcgMUdCIDJHQgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IEVudmlyb25tZW50IFNp\
emluZwogICAgICAtIG5hbWU6IE1TU1FMX01FTU9SWV9SRVFVRVNUCiAgICAgICAgcmVxdWlyZWQ6\
IHRydWUKICAgICAgICBkZWZhdWx0OiAyCiAgICAgICAgdHlwZTogaW50ZWdlcgogICAgICAgIHRp\
dGxlOgogICAgICAgICAgUmVxdWVzdGVkIGFtb3VudCBvZiBtZW1vcnkgZm9yIHRoZSBjb250YWlu\
ZXIgdG8gc3RhcnQgKGluIEdCKQogICAgICAgICAgZWcgMUdCIDJHQgogICAgICAgIGRpc3BsYXlf\
Z3JvdXA6IEVudmlyb25tZW50IFNpemluZwo="

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN chown -R apb:0 /opt/{ansible,apb} && \
    chmod -R g=u /opt/{ansible,apb}
USER apb
ENV ANSIBLE_PIPELINING=True \
    ANSIBLE_CALLBACK_WHITELIST=profile_tasks
