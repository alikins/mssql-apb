FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"LS0tCnZlcnNpb246IDEuMApuYW1lOiBtc3NxbC1hcGIKZGVzY3JpcHRpb246IEFQQiB0byBkZXBs\
b3kgTWljcm9zb2Z0IFNRTCBTZXJ2ZXIgb24gTGludXggMjAxNyBEZXZlbG9wZXIgRWRpdGlvbgpi\
aW5kYWJsZTogdHJ1ZQphc3luYzogb3B0aW9uYWwKbWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6IE1T\
IFNRTCBTZXJ2ZXIgb24gTGludXggKEFQQikKICBpbWFnZVVybDoKICAgIGh0dHBzOi8vcmF3Lmdp\
dGh1YnVzZXJjb250ZW50LmNvbS9hbnNpYmxlcGxheWJvb2tidW5kbGUvbXNzcWwtYXBiL21hc3Rl\
ci9kb2NzL2ltZy9zcWwtc2VydmVyLnBuZwogIGRvY3VtZW50YXRpb25Vcmw6CiAgICBodHRwczov\
L2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9zcWwvbGludXgvc3FsLXNlcnZlci1saW51eC1vdmVy\
dmlldwogIGRlcGVuZGVuY2llczogWydkb2NrZXIuaW8vdGNodWdoZXNpdi9tc3NxbC1zZXJ2ZXIt\
bGludXgnXQp0YWdzOgogIC0gZGF0YWJhc2UKcGxhbnM6CiAgLSBuYW1lOiBlcGhlbWVyYWwKICAg\
IGRlc2NyaXB0aW9uOiBUaGlzIHBsYW4gZGVwbG95cyBhbiBlcGhlbWVyYWwgTVMgU1FMIFNlcnZl\
ci4KICAgIGZyZWU6IHRydWUKICAgIGRlZmF1bHQ6IHRydWUKICAgIG1ldGFkYXRhOgogICAgICBk\
aXNwbGF5TmFtZTogRXBoZW1lcmFsIGluc3RhbGxhdGlvbgogICAgICBsb25nRGVzY3JpcHRpb246\
CiAgICAgICAgVGhpcyBwbGFuIHdpbGwgZGVwbG95IGEgc3RhbmRhbG9uZSBNUyBTUUwgU2VydmVy\
IG9uIExpbnV4CiAgICAgICAgdXNpbmcgZXBoZW1lcmFsIHN0b3JhZ2UKICAgIHBhcmFtZXRlcnM6\
CiAgICAgIC0gbmFtZTogTVNTUUxfUEFTU1dPUkQKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAg\
ICAgIGRlZmF1bHQ6ICJIZWxsbzEyMyEiCiAgICAgICAgcGF0dGVybjogIl4oPzooPzpbYS16XSsu\
KltBLVpdKy4qKFxcZHxcXFcpKy4qKVwKICAgICAgICAgIHwoPzpbQS1aXSsuKlthLXpdKy4qKFxc\
ZHxcXFcpKy4qKVwKICAgICAgICAgIHwoPzooXFxkfFxcVykrLipbYS16XS4qW0EtWl0uKil8KD86\
KFxcZHxcXFcpKy4qW0EtWl0rLipbYS16XSsuKilcCiAgICAgICAgICB8KD86W0EtWl0rLiooXFxk\
fFxcVykrLipbYS16XSsuKil8KD86W2Etel0rLiooXFxkfFxcVykrLipbQS1aXSsuKilcCiAgICAg\
ICAgICB8KD86XFxkKy4qXFxXKy4qKFtBLVpdfFthLXpdKSsuKil8KD86XFxXKy4qXFxkKy4qKFtB\
LVpdfFthLXpdKSsuKilcCiAgICAgICAgICB8KD86KFtBLVpdfFthLXpdKSsuKlxcZCsuKlxcVysu\
Kil8KD86KFtBLVpdfFthLXpdKSsuKlxcVysuKlxcZCsuKilcCiAgICAgICAgICB8KD86XFxXKy4q\
KFtBLVpdfFthLXpdKSsuKlxcZCsuKil8KD86XFxkKy4qKFtBLVpdfFthLXpdKSsuKlxcVysuKikp\
JCIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICBkaXNwbGF5X3R5cGU6IHBhc3N3b3JkCiAg\
ICAgICAgdGl0bGU6ICJQYXNzd29yZCBmb3IgdGhlIGRhdGFiYXNlIGFkbWluIChTQSkgdXNlci4i\
CiAgICAgICAgZGVzY3JpcHRpb246CiAgICAgICAgICAiVGhlIHBhc3N3b3JkIG11c3QgYmUgYXQg\
bGVhc3QgOCBjaGFyYWN0ZXJzIGxvbmcgYW5kIGNvbnRhaW4KICAgICAgICAgIGNoYXJhY3RlcnMg\
ZnJvbSB0aHJlZSBvZiB0aGUgZm9sbG93aW5nIGZvdXIgc2V0czogVXBwZXJjYXNlCiAgICAgICAg\
ICBsZXR0ZXJzLCBMb3dlcmNhc2UgbGV0dGVycywgQmFzZSAxMCBkaWdpdHMsIGFuZCBTeW1ib2xz\
LiBZb3UKICAgICAgICAgIGNhbiBleGFtaW5lIHRoZSBlcnJvciBsb2cgYnkgZXhlY3V0aW5nIHRo\
ZSBkb2NrZXIgbG9ncyBjb21tYW5kLiIKICAgICAgICBkaXNwbGF5X2dyb3VwOiBNUyBTUUwgQ29u\
ZmlnCiAgICAgICAgbWluX2xlbmd0aDogOAogICAgICAgIG1heF9sZW5ndGg6IDEyOAogICAgICAt\
IG5hbWU6IE1TU1FMX0RBVEFCQVNFCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZh\
dWx0OiBzYW1wbGVkYgogICAgICAgIHBhdHRlcm46ICJeW2EtekEtWjAtOV8tXSokIgogICAgICAg\
IHR5cGU6IHN0cmluZwogICAgICAgIHRpdGxlOiBOYW1lIG9mIHRoZSBNUyBTUUwgZGF0YWJhc2Ug\
YWNjZXNzZWQKICAgICAgICBkaXNwbGF5X2dyb3VwOiBNUyBTUUwgQ29uZmlnCiAgICAgIC0gbmFt\
ZTogTVNTUUxfTUVNT1JZX0xJTUlUCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZh\
dWx0OiAyCiAgICAgICAgdHlwZTogaW50ZWdlcgogICAgICAgIHRpdGxlOgogICAgICAgICAgTWF4\
aW11bSBhbW91bnQgb2YgbWVtb3J5IHRoZSBjb250YWluZXIgY2FuIHVzZSAoaW4gR2kpIGVnIDUx\
Mk1pIDFHaQogICAgICAgIGRpc3BsYXlfZ3JvdXA6IEVudmlyb25tZW50IFNpemluZwogICAgICAt\
IG5hbWU6IE1TU1FMX01FTU9SWV9SRVFVRVNUCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAg\
ICBkZWZhdWx0OiAxCiAgICAgICAgdHlwZTogaW50ZWdlcgogICAgICAgIHRpdGxlOgogICAgICAg\
ICAgUmVxdWVzdGVkIGFtb3VudCBvZiBtZW1vcnkgZm9yIHRoZSBjb250YWluZXIgdG8gc3RhcnQg\
KGluIEdpKQogICAgICAgICAgZWcgMUdpIDJHaQogICAgICAgIGRpc3BsYXlfZ3JvdXA6IEVudmly\
b25tZW50IFNpemluZwoKICAtIG5hbWU6IHBlcnNpc3RlbnQKICAgIGRlc2NyaXB0aW9uOiBUaGlz\
IHBsYW4gZGVwbG95cyBhIHBlcnNpc3RlbnQgTVMgU1FMIFNlcnZlci4KICAgIGZyZWU6IHRydWUK\
ICAgIGRlZmF1bHQ6IGZhbHNlCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5hbWU6IFBlcnNp\
c3RlbnQgaW5zdGFsbGF0aW9uCiAgICAgIGxvbmdEZXNjcmlwdGlvbjoKICAgICAgICBUaGlzIHBs\
YW4gd2lsbCBkZXBsb3kgYSBzdGFuZGFsb25lIE1TIFNRTCBTZXJ2ZXIgb24gTGludXgKICAgICAg\
ICB1c2luZyBwZXJzaXN0ZW50IHN0b3JhZ2UKICAgIHBhcmFtZXRlcnM6CiAgICAgIC0gbmFtZTog\
TVNTUUxfUEFTU1dPUkQKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6ICJI\
ZWxsbzEyMyEiCiAgICAgICAgcGF0dGVybjogIl4oPzooPzpbYS16XSsuKltBLVpdKy4qKFxcZHxc\
XFcpKy4qKVwKICAgICAgICAgIHwoPzpbQS1aXSsuKlthLXpdKy4qKFxcZHxcXFcpKy4qKVwKICAg\
ICAgICAgIHwoPzooXFxkfFxcVykrLipbYS16XS4qW0EtWl0uKil8KD86KFxcZHxcXFcpKy4qW0Et\
Wl0rLipbYS16XSsuKilcCiAgICAgICAgICB8KD86W0EtWl0rLiooXFxkfFxcVykrLipbYS16XSsu\
Kil8KD86W2Etel0rLiooXFxkfFxcVykrLipbQS1aXSsuKilcCiAgICAgICAgICB8KD86XFxkKy4q\
XFxXKy4qKFtBLVpdfFthLXpdKSsuKil8KD86XFxXKy4qXFxkKy4qKFtBLVpdfFthLXpdKSsuKilc\
CiAgICAgICAgICB8KD86KFtBLVpdfFthLXpdKSsuKlxcZCsuKlxcVysuKil8KD86KFtBLVpdfFth\
LXpdKSsuKlxcVysuKlxcZCsuKilcCiAgICAgICAgICB8KD86XFxXKy4qKFtBLVpdfFthLXpdKSsu\
KlxcZCsuKil8KD86XFxkKy4qKFtBLVpdfFthLXpdKSsuKlxcVysuKikpJCIKICAgICAgICB0eXBl\
OiBzdHJpbmcKICAgICAgICBkaXNwbGF5X3R5cGU6IHBhc3N3b3JkCiAgICAgICAgdGl0bGU6ICJQ\
YXNzd29yZCBmb3IgdGhlIGRhdGFiYXNlIGFkbWluIChTQSkgdXNlci4iCiAgICAgICAgZGVzY3Jp\
cHRpb246CiAgICAgICAgICAiVGhlIHBhc3N3b3JkIG11c3QgYmUgYXQgbGVhc3QgOCBjaGFyYWN0\
ZXJzIGxvbmcgYW5kIGNvbnRhaW4KICAgICAgICAgIGNoYXJhY3RlcnMgZnJvbSB0aHJlZSBvZiB0\
aGUgZm9sbG93aW5nIGZvdXIgc2V0czogVXBwZXJjYXNlCiAgICAgICAgICBsZXR0ZXJzLCBMb3dl\
cmNhc2UgbGV0dGVycywgQmFzZSAxMCBkaWdpdHMsIGFuZCBTeW1ib2xzLiBZb3UKICAgICAgICAg\
IGNhbiBleGFtaW5lIHRoZSBlcnJvciBsb2cgYnkgZXhlY3V0aW5nIHRoZSBkb2NrZXIgbG9ncyBj\
b21tYW5kLiIKICAgICAgICBkaXNwbGF5X2dyb3VwOiBNUyBTUUwgQ29uZmlnCiAgICAgICAgbWlu\
X2xlbmd0aDogOAogICAgICAgIG1heF9sZW5ndGg6IDEyOAogICAgICAtIG5hbWU6IE1TU1FMX0RB\
VEFCQVNFCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiBzYW1wbGVkYgog\
ICAgICAgIHBhdHRlcm46ICJeW2EtekEtWjAtOV8tXSokIgogICAgICAgIHR5cGU6IHN0cmluZwog\
ICAgICAgIHRpdGxlOiBOYW1lIG9mIHRoZSBNUyBTUUwgZGF0YWJhc2UgYWNjZXNzZWQKICAgICAg\
ICBkaXNwbGF5X2dyb3VwOiBNUyBTUUwgQ29uZmlnCiAgICAgIC0gbmFtZTogTVNTUUxfREFUQV9T\
VE9SQUdFX1NJWkUKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IDEKICAg\
ICAgICB0eXBlOiBpbnRlZ2VyCiAgICAgICAgdGl0bGU6IFBlcnNpc3RlbnQgdm9sdW1lIHNpemUg\
Zm9yIGRiIGRhdGEgKGluIEdpKSBlZyA1MTJNaSAxR2kKICAgICAgICBkaXNwbGF5X2dyb3VwOiBF\
bnZpcm9ubWVudCBTaXppbmcKICAgICAgLSBuYW1lOiBNU1NRTF9NRU1PUllfTElNSVQKICAgICAg\
ICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IDMKICAgICAgICB0eXBlOiBpbnRlZ2Vy\
CiAgICAgICAgdGl0bGU6CiAgICAgICAgICBNYXhpbXVtIGFtb3VudCBvZiBtZW1vcnkgdGhlIGNv\
bnRhaW5lciBjYW4gdXNlIChpbiBHaSkgZWcgNTEyTWkgMUdpCiAgICAgICAgZGlzcGxheV9ncm91\
cDogRW52aXJvbm1lbnQgU2l6aW5nCiAgICAgIC0gbmFtZTogTVNTUUxfTUVNT1JZX1JFUVVFU1QK\
ICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IDIKICAgICAgICB0eXBlOiBp\
bnRlZ2VyCiAgICAgICAgdGl0bGU6CiAgICAgICAgICBSZXF1ZXN0ZWQgYW1vdW50IG9mIG1lbW9y\
eSBmb3IgdGhlIGNvbnRhaW5lciB0byBzdGFydCAoaW4gR2kpCiAgICAgICAgICBlZyAxR2kgMkdp\
CiAgICAgICAgZGlzcGxheV9ncm91cDogRW52aXJvbm1lbnQgU2l6aW5nCg=="



COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN yum -y install --setopt=tsflags=nodocs python-pip && \
    yum clean all && \
    chown -R 0 /opt/{ansible,apb} && \
    pip install --upgrade pip && \
    pip install pymssql && \
    chown -R apb:0 /opt/{ansible,apb} && \
    chmod -R g=u /opt/{ansible,apb}
USER apb
