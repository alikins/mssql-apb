FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"LS0tCnZlcnNpb246IDEuMApuYW1lOiBtc3NxbC1hcGIKZGVzY3JpcHRpb246IEFQQiB0byBkZXBs\
b3kgU1FMIFNlcnZlciBvbiBMaW51eApiaW5kYWJsZTogdHJ1ZQphc3luYzogb3B0aW9uYWwKbWV0\
YWRhdGE6CiAgZGlzcGxheU5hbWU6IFNRTCBTZXJ2ZXIgb24gTGludXggKEFQQikKICBpbWFnZVVy\
bDoKICAgIGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9hbnNpYmxlcGxheWJvb2ti\
dW5kbGUvbXNzcWwtYXBiL21hc3Rlci9kb2NzL2ltZy9zcWwtc2VydmVyLnBuZwogIGRvY3VtZW50\
YXRpb25Vcmw6CiAgICBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9zcWwvbGludXgv\
c3FsLXNlcnZlci1saW51eC1vdmVydmlldwogIHNlcnZpY2VOYW1lOiBtc3NxbC1zZXJ2ZXIKICBk\
ZXBlbmRlbmNpZXM6IFsnZG9ja2VyLmlvL3RjaHVnaGVzaXYvbXNzcWwtc2VydmVyLWxpbnV4J10K\
dGFnczoKICAtIGRhdGFiYXNlCnBsYW5zOgogIC0gbmFtZTogZXBoZW1lcmFsCiAgICBkZXNjcmlw\
dGlvbjogVGhpcyBwbGFuIGRlcGxveXMgYW4gZXBoZW1lcmFsIG1zc3FsLXNlcnZlci4KICAgIGZy\
ZWU6IHRydWUKICAgIGRlZmF1bHQ6IHRydWUKICAgIG1ldGFkYXRhOgogICAgICBkaXNwbGF5TmFt\
ZTogRXBoZW1lcmFsIGluc3RhbGxhdGlvbgogICAgICBsb25nRGVzY3JpcHRpb246CiAgICAgICAg\
VGhpcyBwbGFuIHdpbGwgZGVwbG95IGEgTVMgU1FMIFNlcnZlciBvbiBMaW51eCBzdGFuZGFsb25l\
CiAgICAgICAgdXNpbmcgZXBoZW1lcmFsIHN0b3JhZ2UKICAgIHBhcmFtZXRlcnM6CiAgICAgIC0g\
bmFtZTogTVNTUUxfUEFTU1dPUkQKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1\
bHQ6ICJ5b3VyU3Ryb25nQFBhc3N3b3JkIgogICAgICAgIHBhdHRlcm46ICJeKD86KD86W2Etel0r\
LipbQS1aXSsuKihcXGR8XFxXKSsuKilcCiAgICAgICAgICB8KD86W0EtWl0rLipbYS16XSsuKihc\
XGR8XFxXKSsuKilcCiAgICAgICAgICB8KD86KFxcZHxcXFcpKy4qW2Etel0uKltBLVpdLiopfCg/\
OihcXGR8XFxXKSsuKltBLVpdKy4qW2Etel0rLiopXAogICAgICAgICAgfCg/OltBLVpdKy4qKFxc\
ZHxcXFcpKy4qW2Etel0rLiopfCg/OlthLXpdKy4qKFxcZHxcXFcpKy4qW0EtWl0rLiopXAogICAg\
ICAgICAgfCg/OlxcZCsuKlxcVysuKihbQS1aXXxbYS16XSkrLiopfCg/OlxcVysuKlxcZCsuKihb\
QS1aXXxbYS16XSkrLiopXAogICAgICAgICAgfCg/OihbQS1aXXxbYS16XSkrLipcXGQrLipcXFcr\
LiopfCg/OihbQS1aXXxbYS16XSkrLipcXFcrLipcXGQrLiopXAogICAgICAgICAgfCg/OlxcVysu\
KihbQS1aXXxbYS16XSkrLipcXGQrLiopfCg/OlxcZCsuKihbQS1aXXxbYS16XSkrLipcXFcrLiop\
KSQiCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAog\
ICAgICAgIHRpdGxlOiAiUGFzc3dvcmQgZm9yIHRoZSBkYXRhYmFzZSBhZG1pbiAoU0EpIHVzZXIu\
IgogICAgICAgIGRlc2NyaXB0aW9uOgogICAgICAgICAgIlRoZSBwYXNzd29yZCBtdXN0IGJlIGF0\
IGxlYXN0IDggY2hhcmFjdGVycyBsb25nIGFuZCBjb250YWluCiAgICAgICAgICBjaGFyYWN0ZXJz\
IGZyb20gdGhyZWUgb2YgdGhlIGZvbGxvd2luZyBmb3VyIHNldHM6IFVwcGVyY2FzZQogICAgICAg\
ICAgbGV0dGVycywgTG93ZXJjYXNlIGxldHRlcnMsIEJhc2UgMTAgZGlnaXRzLCBhbmQgU3ltYm9s\
cy4gWW91CiAgICAgICAgICBjYW4gZXhhbWluZSB0aGUgZXJyb3IgbG9nIGJ5IGV4ZWN1dGluZyB0\
aGUgZG9ja2VyIGxvZ3MgY29tbWFuZC4iCiAgICAgICAgZGlzcGxheV9ncm91cDogTVMgU1FMIENv\
bmZpZwogICAgICAgIG1pbl9sZW5ndGg6IDgKICAgICAgICBtYXhfbGVuZ3RoOiAxMjgKICAgICAg\
LSBuYW1lOiBNU1NRTF9EQVRBQkFTRQogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVm\
YXVsdDogc2FtcGxlZGIKICAgICAgICBwYXR0ZXJuOiAiXlthLXpBLVowLTlfLV0qJCIKICAgICAg\
ICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTogTmFtZSBvZiB0aGUgTVMgU1FMIGRhdGFiYXNl\
IGFjY2Vzc2VkCiAgICAgICAgZGlzcGxheV9ncm91cDogTVMgU1FMIENvbmZpZwogICAgICAtIG5h\
bWU6IE1TU1FMX01FTU9SWV9MSU1JVAogICAgICAgIGRlZmF1bHQ6IDJHaQogICAgICAgIHR5cGU6\
IHN0cmluZwogICAgICAgIHRpdGxlOiBNYXhpbXVtIGFtb3VudCBvZiBtZW1vcnkgdGhlIGNvbnRh\
aW5lciBjYW4gdXNlIGVnIDUxMk1pIDFHaQogICAgICAgIGRpc3BsYXlfZ3JvdXA6IEVudmlyb25t\
ZW50IFNpemluZwogICAgICAtIG5hbWU6IE1TU1FMX01FTU9SWV9SRVFVRVNUCiAgICAgICAgZGVm\
YXVsdDogMUdpCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgdGl0bGU6IFJlcXVlc3RlZCBh\
bW91bnQgb2YgbWVtb3J5IGZvciB0aGUgY29udGFpbmVyIHRvIHN0YXJ0IGVnIDFHaSAyR2kKICAg\
ICAgICBkaXNwbGF5X2dyb3VwOiBFbnZpcm9ubWVudCBTaXppbmcK"

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN yum -y install --setopt=tsflags=nodocs python-pip && \
    yum clean all && \
    chown -R 0 /opt/{ansible,apb} && \
    pip install --upgrade pip && \
    pip install pymssql && \
    chown -R apb:0 /opt/{ansible,apb} && \
    chmod -R g=u /opt/{ansible,apb}
USER apb
