FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"LS0tCnZlcnNpb246IDEuMApuYW1lOiBtc3NxbC1hcGIKZGVzY3JpcHRpb246IEFQQiB0byBkZXBs\
b3kgTWljcm9zb2Z0IFNRTCBTZXJ2ZXIgb24gTGludXggMjAxNwpiaW5kYWJsZTogdHJ1ZQphc3lu\
Yzogb3B0aW9uYWwKbWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6IE1TIFNRTCBTZXJ2ZXIgb24gTGlu\
dXggKEFQQikKICBpbWFnZVVybDoKICAgIGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNv\
bS9hbnNpYmxlcGxheWJvb2tidW5kbGUvbXNzcWwtYXBiL21hc3Rlci9kb2NzL2ltZy9zcWwtc2Vy\
dmVyLnBuZwogIGRvY3VtZW50YXRpb25Vcmw6CiAgICBodHRwczovL2RvY3MubWljcm9zb2Z0LmNv\
bS9lbi11cy9zcWwvbGludXgvc3FsLXNlcnZlci1saW51eC1vdmVydmlldwogIGRlcGVuZGVuY2ll\
czogWydkb2NrZXIuaW8vdGNodWdoZXNpdi9tc3NxbC1zZXJ2ZXItbGludXgnXQp0YWdzOgogIC0g\
ZGF0YWJhc2UKICAtIG1zc3FsCnBsYW5zOgogIC0gbmFtZTogZXBoZW1lcmFsCiAgICBkZXNjcmlw\
dGlvbjogVGhpcyBwbGFuIGRlcGxveXMgYW4gZXBoZW1lcmFsIE1TIFNRTCBTZXJ2ZXIuCiAgICBm\
cmVlOiB0cnVlCiAgICBkZWZhdWx0OiB0cnVlCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5h\
bWU6IEVwaGVtZXJhbCBpbnN0YWxsYXRpb24KICAgICAgbG9uZ0Rlc2NyaXB0aW9uOgogICAgICAg\
IFRoaXMgcGxhbiB3aWxsIGRlcGxveSBhIHN0YW5kYWxvbmUgTVMgU1FMIFNlcnZlciBvbiBMaW51\
eAogICAgICAgIHVzaW5nIGVwaGVtZXJhbCBzdG9yYWdlCiAgICBwYXJhbWV0ZXJzOgogICAgICAt\
IG5hbWU6IE1TU1FMX1BBU1NXT1JECiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZh\
dWx0OiAiSGVsbG8xMjMhIgogICAgICAgIHBhdHRlcm46ICJeKD86KD86W2Etel0rLipbQS1aXSsu\
KihcXGR8XFxXKSsuKilcCiAgICAgICAgICB8KD86W0EtWl0rLipbYS16XSsuKihcXGR8XFxXKSsu\
KilcCiAgICAgICAgICB8KD86KFxcZHxcXFcpKy4qW2Etel0uKltBLVpdLiopfCg/OihcXGR8XFxX\
KSsuKltBLVpdKy4qW2Etel0rLiopXAogICAgICAgICAgfCg/OltBLVpdKy4qKFxcZHxcXFcpKy4q\
W2Etel0rLiopfCg/OlthLXpdKy4qKFxcZHxcXFcpKy4qW0EtWl0rLiopXAogICAgICAgICAgfCg/\
OlxcZCsuKlxcVysuKihbQS1aXXxbYS16XSkrLiopfCg/OlxcVysuKlxcZCsuKihbQS1aXXxbYS16\
XSkrLiopXAogICAgICAgICAgfCg/OihbQS1aXXxbYS16XSkrLipcXGQrLipcXFcrLiopfCg/Oihb\
QS1aXXxbYS16XSkrLipcXFcrLipcXGQrLiopXAogICAgICAgICAgfCg/OlxcVysuKihbQS1aXXxb\
YS16XSkrLipcXGQrLiopfCg/OlxcZCsuKihbQS1aXXxbYS16XSkrLipcXFcrLiopKSQiCiAgICAg\
ICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICAgIHRp\
dGxlOiAiUGFzc3dvcmQgZm9yIHRoZSBkYXRhYmFzZSBhZG1pbiAoU0EpIHVzZXIuIgogICAgICAg\
IGRlc2NyaXB0aW9uOgogICAgICAgICAgIlRoZSBwYXNzd29yZCBtdXN0IGJlIGF0IGxlYXN0IDgg\
Y2hhcmFjdGVycyBsb25nIGFuZCBjb250YWluCiAgICAgICAgICBjaGFyYWN0ZXJzIGZyb20gdGhy\
ZWUgb2YgdGhlIGZvbGxvd2luZyBmb3VyIHNldHM6IFVwcGVyY2FzZQogICAgICAgICAgbGV0dGVy\
cywgTG93ZXJjYXNlIGxldHRlcnMsIEJhc2UgMTAgZGlnaXRzLCBhbmQgU3ltYm9scy4iCiAgICAg\
ICAgZGlzcGxheV9ncm91cDogTVMgU1FMIENvbmZpZwogICAgICAgIG1pbl9sZW5ndGg6IDgKICAg\
ICAgICBtYXhfbGVuZ3RoOiAxMjgKICAgICAgLSBuYW1lOiBNU1NRTF9EQVRBQkFTRQogICAgICAg\
IHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogVGVzdERCCiAgICAgICAgcGF0dGVybjog\
Il5bYS16QS1aMC05Xy1dKiQiCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgdGl0bGU6IE5h\
bWUgb2YgdGhlIE1TIFNRTCBkYXRhYmFzZSB0byBjcmVhdGUuCiAgICAgICAgZGlzcGxheV9ncm91\
cDogTVMgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1TU1FMX1BJRAogICAgICAgIHJlcXVpcmVk\
OiB0cnVlCiAgICAgICAgdHlwZTogZW51bQogICAgICAgIGVudW06IFsnRGV2ZWxvcGVyJywgJ0V2\
YWx1YXRpb24nXQogICAgICAgIGRlZmF1bHQ6IERldmVsb3BlcgogICAgICAgIHRpdGxlOiBTZXQg\
dGhlIFNRTCBTZXJ2ZXIgZWRpdGlvbi4KICAgICAgICBkaXNwbGF5X2dyb3VwOiBNUyBTUUwgQ29u\
ZmlnCiAgICAgIC0gbmFtZTogTVNTUUxfQUdFTlRfRU5BQkxFRAogICAgICAgIHRpdGxlOiBFbmFi\
bGUgU1FMIFNlcnZlciBBZ2VudC4KICAgICAgICB0eXBlOiBib29sZWFuCiAgICAgICAgcmVxdWly\
ZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiBmYWxzZQogICAgICAgIGRlc2NyaXB0aW9uOiBCeSBk\
ZWZhdWx0LCBhZ2VudCBpcyBkaXNhYmxlZC4KICAgICAgICBkaXNwbGF5X2dyb3VwOiBNUyBTUUwg\
Q29uZmlnCiAgICAgIC0gbmFtZTogTVNTUUxfTE9DQUxfSVMKICAgICAgICB0aXRsZTogVXNlIGV4\
aXN0aW5nIG1zc3FsLXNlcnZlci1saW51eCBpbWFnZXN0cmVhbSBpbiBwcm9qZWN0LgogICAgICAg\
IHR5cGU6IGJvb2xlYW4KICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IGZh\
bHNlCiAgICAgICAgZGVzY3JpcHRpb246IEJ5IGRlZmF1bHQsIGFnZW50IGlzIGRpc2FibGVkLgog\
ICAgICAgIGRpc3BsYXlfZ3JvdXA6IE1TIFNRTCBDb25maWcKICAgICAgLSBuYW1lOiBNU1NRTF9M\
Q0lECiAgICAgICAgdGl0bGU6IFNldCB0aGUgbGFuZ3VhZ2UgSUQuCiAgICAgICAgdHlwZTogaW50\
ZWdlcgogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogMTAzMwogICAgICAg\
IGRlc2NyaXB0aW9uOiBGb3IgZXhhbXBsZSAtIDEwMzMgaXMgRW5nbGlzaCAoVVMpLCAxMDM2IGlz\
IEZyZW5jaC4KICAgICAgICBtaW5fbGVuZ3RoOiA0CiAgICAgICAgbWF4X2xlbmd0aDogNAogICAg\
ICAgIGRpc3BsYXlfZ3JvdXA6IE1TIFNRTCBDb25maWcKICAgICAgLSBuYW1lOiBNU1NRTF9JTUFH\
RV9QVUxMCiAgICAgICAgdGl0bGU6ICJEZXBsb3ltZW50Q29uZmlnIEltYWdlIHB1bGwgcG9saWN5\
IgogICAgICAgIHR5cGU6IGVudW0KICAgICAgICBlbnVtOiBbJ0Fsd2F5cycsICdJZk5vdFByZXNl\
bnQnLCAnTmV2ZXInXQogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogSWZO\
b3RQcmVzZW50CiAgICAgICAgZGlzcGxheV9ncm91cDogTVMgU1FMIENvbmZpZwogICAgICAtIG5h\
bWU6IE1TU1FMX01FTU9SWV9MSU1JVAogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVm\
YXVsdDogMwogICAgICAgIHR5cGU6IGludGVnZXIKICAgICAgICB0aXRsZToKICAgICAgICAgIE1h\
eGltdW0gYW1vdW50IG9mIG1lbW9yeSB0aGUgY29udGFpbmVyIGNhbiB1c2UgKGluIEdCKSBlZyAx\
R0IgMkdCCiAgICAgICAgZGlzcGxheV9ncm91cDogRW52aXJvbm1lbnQgU2l6aW5nCiAgICAgIC0g\
bmFtZTogTVNTUUxfTUVNT1JZX1JFUVVFU1QKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAg\
IGRlZmF1bHQ6IDIKICAgICAgICB0eXBlOiBpbnRlZ2VyCiAgICAgICAgdGl0bGU6CiAgICAgICAg\
ICBSZXF1ZXN0ZWQgYW1vdW50IG9mIG1lbW9yeSBmb3IgdGhlIGNvbnRhaW5lciB0byBzdGFydCAo\
aW4gR0IpCiAgICAgICAgICBlZyAxR0IgMkdCCiAgICAgICAgZGlzcGxheV9ncm91cDogRW52aXJv\
bm1lbnQgU2l6aW5nCgogIC0gbmFtZTogcGVyc2lzdGVudAogICAgZGVzY3JpcHRpb246IFRoaXMg\
cGxhbiBkZXBsb3lzIGEgcGVyc2lzdGVudCBNUyBTUUwgU2VydmVyLgogICAgZnJlZTogdHJ1ZQog\
ICAgbWV0YWRhdGE6CiAgICAgIGRpc3BsYXlOYW1lOiBQZXJzaXN0ZW50IGluc3RhbGxhdGlvbgog\
ICAgICBsb25nRGVzY3JpcHRpb246CiAgICAgICAgVGhpcyBwbGFuIHdpbGwgZGVwbG95IGEgc3Rh\
bmRhbG9uZSBNUyBTUUwgU2VydmVyIG9uIExpbnV4CiAgICAgICAgdXNpbmcgcGVyc2lzdGVudCBz\
dG9yYWdlCiAgICBwYXJhbWV0ZXJzOgogICAgICAtIG5hbWU6IE1TU1FMX1BBU1NXT1JECiAgICAg\
ICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiAiSGVsbG8xMjMhIgogICAgICAgIHBh\
dHRlcm46ICJeKD86KD86W2Etel0rLipbQS1aXSsuKihcXGR8XFxXKSsuKilcCiAgICAgICAgICB8\
KD86W0EtWl0rLipbYS16XSsuKihcXGR8XFxXKSsuKilcCiAgICAgICAgICB8KD86KFxcZHxcXFcp\
Ky4qW2Etel0uKltBLVpdLiopfCg/OihcXGR8XFxXKSsuKltBLVpdKy4qW2Etel0rLiopXAogICAg\
ICAgICAgfCg/OltBLVpdKy4qKFxcZHxcXFcpKy4qW2Etel0rLiopfCg/OlthLXpdKy4qKFxcZHxc\
XFcpKy4qW0EtWl0rLiopXAogICAgICAgICAgfCg/OlxcZCsuKlxcVysuKihbQS1aXXxbYS16XSkr\
LiopfCg/OlxcVysuKlxcZCsuKihbQS1aXXxbYS16XSkrLiopXAogICAgICAgICAgfCg/OihbQS1a\
XXxbYS16XSkrLipcXGQrLipcXFcrLiopfCg/OihbQS1aXXxbYS16XSkrLipcXFcrLipcXGQrLiop\
XAogICAgICAgICAgfCg/OlxcVysuKihbQS1aXXxbYS16XSkrLipcXGQrLiopfCg/OlxcZCsuKihb\
QS1aXXxbYS16XSkrLipcXFcrLiopKSQiCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGlz\
cGxheV90eXBlOiBwYXNzd29yZAogICAgICAgIHRpdGxlOiAiUGFzc3dvcmQgZm9yIHRoZSBkYXRh\
YmFzZSBhZG1pbiAoU0EpIHVzZXIuIgogICAgICAgIGRlc2NyaXB0aW9uOgogICAgICAgICAgIlRo\
ZSBwYXNzd29yZCBtdXN0IGJlIGF0IGxlYXN0IDggY2hhcmFjdGVycyBsb25nIGFuZCBjb250YWlu\
CiAgICAgICAgICBjaGFyYWN0ZXJzIGZyb20gdGhyZWUgb2YgdGhlIGZvbGxvd2luZyBmb3VyIHNl\
dHM6IFVwcGVyY2FzZQogICAgICAgICAgbGV0dGVycywgTG93ZXJjYXNlIGxldHRlcnMsIEJhc2Ug\
MTAgZGlnaXRzLCBhbmQgU3ltYm9scy4iCiAgICAgICAgZGlzcGxheV9ncm91cDogTVMgU1FMIENv\
bmZpZwogICAgICAgIG1pbl9sZW5ndGg6IDgKICAgICAgICBtYXhfbGVuZ3RoOiAxMjgKICAgICAg\
LSBuYW1lOiBNU1NRTF9EQVRBQkFTRQogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVm\
YXVsdDogVGVzdERCCiAgICAgICAgcGF0dGVybjogIl5bYS16QS1aMC05Xy1dKiQiCiAgICAgICAg\
dHlwZTogc3RyaW5nCiAgICAgICAgdGl0bGU6IE5hbWUgb2YgdGhlIE1TIFNRTCBkYXRhYmFzZSB0\
byBjcmVhdGUuCiAgICAgICAgZGlzcGxheV9ncm91cDogTVMgU1FMIENvbmZpZwogICAgICAtIG5h\
bWU6IE1TU1FMX1BJRAogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgdHlwZTogZW51bQog\
ICAgICAgIGVudW06IFsnRGV2ZWxvcGVyJywgJ0V2YWx1YXRpb24nXQogICAgICAgIGRlZmF1bHQ6\
IERldmVsb3BlcgogICAgICAgIHRpdGxlOiBTZXQgdGhlIFNRTCBTZXJ2ZXIgZWRpdGlvbi4KICAg\
ICAgICBkaXNwbGF5X2dyb3VwOiBNUyBTUUwgQ29uZmlnCiAgICAgIC0gbmFtZTogTVNTUUxfQUdF\
TlRfRU5BQkxFRAogICAgICAgIHRpdGxlOiBFbmFibGUgU1FMIFNlcnZlciBBZ2VudC4KICAgICAg\
ICB0eXBlOiBib29sZWFuCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiBm\
YWxzZQogICAgICAgIGRlc2NyaXB0aW9uOiBCeSBkZWZhdWx0LCBhZ2VudCBpcyBkaXNhYmxlZC4K\
ICAgICAgICBkaXNwbGF5X2dyb3VwOiBNUyBTUUwgQ29uZmlnCiAgICAgIC0gbmFtZTogTVNTUUxf\
TE9DQUxfSVMKICAgICAgICB0aXRsZTogVXNlIGV4aXN0aW5nIG1zc3FsLXNlcnZlci1saW51eCBp\
bWFnZXN0cmVhbSBpbiBwcm9qZWN0LgogICAgICAgIHR5cGU6IGJvb2xlYW4KICAgICAgICByZXF1\
aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICAgICAgZGVzY3JpcHRpb246IEJ5\
IGRlZmF1bHQsIGFnZW50IGlzIGRpc2FibGVkLgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IE1TIFNR\
TCBDb25maWcKICAgICAgLSBuYW1lOiBNU1NRTF9MQ0lECiAgICAgICAgdGl0bGU6IFNldCB0aGUg\
bGFuZ3VhZ2UgSUQuCiAgICAgICAgdHlwZTogaW50ZWdlcgogICAgICAgIHJlcXVpcmVkOiB0cnVl\
CiAgICAgICAgZGVmYXVsdDogMTAzMwogICAgICAgIGRlc2NyaXB0aW9uOiBGb3IgZXhhbXBsZSAt\
IDEwMzMgaXMgRW5nbGlzaCAoVVMpLCAxMDM2IGlzIEZyZW5jaC4KICAgICAgICBtaW5fbGVuZ3Ro\
OiA0CiAgICAgICAgbWF4X2xlbmd0aDogNAogICAgICAgIGRpc3BsYXlfZ3JvdXA6IE1TIFNRTCBD\
b25maWcKICAgICAgLSBuYW1lOiBNU1NRTF9JTUFHRV9QVUxMCiAgICAgICAgdGl0bGU6ICJEZXBs\
b3ltZW50Q29uZmlnIEltYWdlIHB1bGwgcG9saWN5IgogICAgICAgIHR5cGU6IGVudW0KICAgICAg\
ICBlbnVtOiBbJ0Fsd2F5cycsICdJZk5vdFByZXNlbnQnLCAnTmV2ZXInXQogICAgICAgIHJlcXVp\
cmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogSWZOb3RQcmVzZW50CiAgICAgICAgZGlzcGxheV9n\
cm91cDogTVMgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1TU1FMX0RBVEFfU1RPUkFHRV9TSVpF\
CiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiAxCiAgICAgICAgdHlwZTog\
aW50ZWdlcgogICAgICAgIHRpdGxlOiBQZXJzaXN0ZW50IHZvbHVtZSBzaXplIGZvciBkYiBkYXRh\
IChpbiBHQikgZWcgMUdCIDJHQgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IEVudmlyb25tZW50IFNp\
emluZwogICAgICAtIG5hbWU6IE1TU1FMX01FTU9SWV9MSU1JVAogICAgICAgIHJlcXVpcmVkOiB0\
cnVlCiAgICAgICAgZGVmYXVsdDogMwogICAgICAgIHR5cGU6IGludGVnZXIKICAgICAgICB0aXRs\
ZToKICAgICAgICAgIE1heGltdW0gYW1vdW50IG9mIG1lbW9yeSB0aGUgY29udGFpbmVyIGNhbiB1\
c2UgKGluIEdCKSBlZyAxR0IgMkdCCiAgICAgICAgZGlzcGxheV9ncm91cDogRW52aXJvbm1lbnQg\
U2l6aW5nCiAgICAgIC0gbmFtZTogTVNTUUxfTUVNT1JZX1JFUVVFU1QKICAgICAgICByZXF1aXJl\
ZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IDIKICAgICAgICB0eXBlOiBpbnRlZ2VyCiAgICAgICAg\
dGl0bGU6CiAgICAgICAgICBSZXF1ZXN0ZWQgYW1vdW50IG9mIG1lbW9yeSBmb3IgdGhlIGNvbnRh\
aW5lciB0byBzdGFydCAoaW4gR0IpCiAgICAgICAgICBlZyAxR0IgMkdCCiAgICAgICAgZGlzcGxh\
eV9ncm91cDogRW52aXJvbm1lbnQgU2l6aW5nCg=="

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN yum -y install --setopt=tsflags=nodocs python-pip && \
    yum clean all && \
    chown -R 0 /opt/{ansible,apb} && \
    pip install --upgrade pip && \
    pip install pymssql && \
    chown -R apb:0 /opt/{ansible,apb} && \
    chmod -R g=u /opt/{ansible,apb}
USER apb
