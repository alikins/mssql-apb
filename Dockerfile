FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"LS0tCnZlcnNpb246IDEuMApuYW1lOiBtc3NxbC1hcGIKZGVzY3JpcHRpb246IEFQQiB0byBkZXBs\
b3kgTWljcm9zb2Z0IFNRTCBTZXJ2ZXIgb24gTGludXggMjAxNwpiaW5kYWJsZTogdHJ1ZQphc3lu\
Yzogb3B0aW9uYWwKbWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6IE1TIFNRTCBTZXJ2ZXIgb24gTGlu\
dXggKEFQQikKICBpbWFnZVVybDoKICAgIGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNv\
bS9hbnNpYmxlcGxheWJvb2tidW5kbGUvbXNzcWwtYXBiL21hc3Rlci9kb2NzL2ltZy9zcWwtc2Vy\
dmVyLnBuZwogIGRvY3VtZW50YXRpb25Vcmw6CiAgICBodHRwczovL2RvY3MubWljcm9zb2Z0LmNv\
bS9lbi11cy9zcWwvbGludXgvc3FsLXNlcnZlci1saW51eC1vdmVydmlldwogIGRlcGVuZGVuY2ll\
czogWydkb2NrZXIuaW8vdGNodWdoZXNpdi9tc3NxbC1zZXJ2ZXItbGludXgnXQp0YWdzOgogIC0g\
ZGF0YWJhc2UKICAtIG1zc3FsCnBsYW5zOgogIC0gbmFtZTogZXBoZW1lcmFsCiAgICBkZXNjcmlw\
dGlvbjogVGhpcyBwbGFuIGRlcGxveXMgYW4gZXBoZW1lcmFsIE1TIFNRTCBTZXJ2ZXIuCiAgICBm\
cmVlOiB0cnVlCiAgICBkZWZhdWx0OiB0cnVlCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5h\
bWU6IEVwaGVtZXJhbCBpbnN0YWxsYXRpb24KICAgICAgbG9uZ0Rlc2NyaXB0aW9uOgogICAgICAg\
IFRoaXMgcGxhbiB3aWxsIGRlcGxveSBhIHN0YW5kYWxvbmUgTVMgU1FMIFNlcnZlciBvbiBMaW51\
eAogICAgICAgIHVzaW5nIGVwaGVtZXJhbCBzdG9yYWdlCiAgICBwYXJhbWV0ZXJzOgogICAgICAt\
IG5hbWU6IE1TU1FMX1BBU1NXT1JECiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZh\
dWx0OiAiSGVsbG8xMjMhIgogICAgICAgIHBhdHRlcm46ICJeKD86KD86W2Etel0rLipbQS1aXSsu\
KihcXGR8XFxXKSsuKilcCiAgICAgICAgICB8KD86W0EtWl0rLipbYS16XSsuKihcXGR8XFxXKSsu\
KilcCiAgICAgICAgICB8KD86KFxcZHxcXFcpKy4qW2Etel0uKltBLVpdLiopfCg/OihcXGR8XFxX\
KSsuKltBLVpdKy4qW2Etel0rLiopXAogICAgICAgICAgfCg/OltBLVpdKy4qKFxcZHxcXFcpKy4q\
W2Etel0rLiopfCg/OlthLXpdKy4qKFxcZHxcXFcpKy4qW0EtWl0rLiopXAogICAgICAgICAgfCg/\
OlxcZCsuKlxcVysuKihbQS1aXXxbYS16XSkrLiopfCg/OlxcVysuKlxcZCsuKihbQS1aXXxbYS16\
XSkrLiopXAogICAgICAgICAgfCg/OihbQS1aXXxbYS16XSkrLipcXGQrLipcXFcrLiopfCg/Oihb\
QS1aXXxbYS16XSkrLipcXFcrLipcXGQrLiopXAogICAgICAgICAgfCg/OlxcVysuKihbQS1aXXxb\
YS16XSkrLipcXGQrLiopfCg/OlxcZCsuKihbQS1aXXxbYS16XSkrLipcXFcrLiopKSQiCiAgICAg\
ICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICAgIHRp\
dGxlOiAiUGFzc3dvcmQgZm9yIHRoZSBkYXRhYmFzZSBhZG1pbiAoU0EpIHVzZXIuIgogICAgICAg\
IGRlc2NyaXB0aW9uOgogICAgICAgICAgIlRoZSBwYXNzd29yZCBtdXN0IGJlIGF0IGxlYXN0IDgg\
Y2hhcmFjdGVycyBsb25nIGFuZCBjb250YWluCiAgICAgICAgICBjaGFyYWN0ZXJzIGZyb20gdGhy\
ZWUgb2YgdGhlIGZvbGxvd2luZyBmb3VyIHNldHM6IFVwcGVyY2FzZQogICAgICAgICAgbGV0dGVy\
cywgTG93ZXJjYXNlIGxldHRlcnMsIEJhc2UgMTAgZGlnaXRzLCBhbmQgU3ltYm9scy4iCiAgICAg\
ICAgZGlzcGxheV9ncm91cDogTVMgU1FMIENvbmZpZwogICAgICAgIG1pbl9sZW5ndGg6IDgKICAg\
ICAgICBtYXhfbGVuZ3RoOiAxMjgKICAgICAgLSBuYW1lOiBNU1NRTF9EQVRBQkFTRQogICAgICAg\
IHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogVGVzdERCCiAgICAgICAgcGF0dGVybjog\
Il5bYS16QS1aMC05Xy1dKiQiCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgdGl0bGU6IE5h\
bWUgb2YgdGhlIE1TIFNRTCBkYXRhYmFzZSBhY2Nlc3NlZAogICAgICAgIGRpc3BsYXlfZ3JvdXA6\
IE1TIFNRTCBDb25maWcKICAgICAgLSBuYW1lOiBNU1NRTF9QSUQKICAgICAgICByZXF1aXJlZDog\
dHJ1ZQogICAgICAgIHR5cGU6IGVudW0KICAgICAgICBlbnVtOiBbJ0V2YWx1YXRpb24nLCAnRGV2\
ZWxvcGVyJywgJ0V4cHJlc3MnXQogICAgICAgIGRlZmF1bHQ6IERldmVsb3BlcgogICAgICAgIHRp\
dGxlOiBTZXQgdGhlIFNRTCBTZXJ2ZXIgZWRpdGlvbi4KICAgICAgICBkaXNwbGF5X2dyb3VwOiBN\
UyBTUUwgQ29uZmlnCiAgICAgIC0gbmFtZTogTVNTUUxfQUdFTlRfRU5BQkxFRAogICAgICAgIHRp\
dGxlOiBFbmFibGUgU1FMIFNlcnZlciBBZ2VudC4KICAgICAgICB0eXBlOiBib29sZWFuCiAgICAg\
ICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiBmYWxzZQogICAgICAgIGRlc2NyaXB0\
aW9uOiBCeSBkZWZhdWx0LCBhZ2VudCBpcyBkaXNhYmxlZC4KICAgICAgICBkaXNwbGF5X2dyb3Vw\
OiBNUyBTUUwgQ29uZmlnCiAgICAgIC0gbmFtZTogTVNTUUxfTENJRAogICAgICAgIHRpdGxlOiBT\
ZXQgdGhlIGxhbmd1YWdlIElELgogICAgICAgIHR5cGU6IGludGVnZXIKICAgICAgICByZXF1aXJl\
ZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IDEwMzMKICAgICAgICBkZXNjcmlwdGlvbjogRm9yIGV4\
YW1wbGUgLSAxMDMzIGlzIEVuZ2xpc2ggKFVTKSwgMTAzNiBpcyBGcmVuY2guCiAgICAgICAgbWlu\
X2xlbmd0aDogNAogICAgICAgIG1heF9sZW5ndGg6IDQKICAgICAgICBkaXNwbGF5X2dyb3VwOiBN\
UyBTUUwgQ29uZmlnCiAgICAgIC0gbmFtZTogTVNTUUxfSU1BR0VfUFVMTAogICAgICAgIHRpdGxl\
OiAiRGVwbG95bWVudENvbmZpZyBJbWFnZSBwdWxsIHBvbGljeSIKICAgICAgICB0eXBlOiBlbnVt\
CiAgICAgICAgZW51bTogWydBbHdheXMnLCAnSWZOb3RQcmVzZW50JywgJ05ldmVyJ10KICAgICAg\
ICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IElmTm90UHJlc2VudAogICAgICAgIGRp\
c3BsYXlfZ3JvdXA6IE1TIFNRTCBDb25maWcKICAgICAgLSBuYW1lOiBNU1NRTF9NRU1PUllfTElN\
SVQKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IDMKICAgICAgICB0eXBl\
OiBpbnRlZ2VyCiAgICAgICAgdGl0bGU6CiAgICAgICAgICBNYXhpbXVtIGFtb3VudCBvZiBtZW1v\
cnkgdGhlIGNvbnRhaW5lciBjYW4gdXNlIChpbiBHQikgZWcgMUdCIDJHQgogICAgICAgIGRpc3Bs\
YXlfZ3JvdXA6IEVudmlyb25tZW50IFNpemluZwogICAgICAtIG5hbWU6IE1TU1FMX01FTU9SWV9S\
RVFVRVNUCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiAyCiAgICAgICAg\
dHlwZTogaW50ZWdlcgogICAgICAgIHRpdGxlOgogICAgICAgICAgUmVxdWVzdGVkIGFtb3VudCBv\
ZiBtZW1vcnkgZm9yIHRoZSBjb250YWluZXIgdG8gc3RhcnQgKGluIEdCKQogICAgICAgICAgZWcg\
MUdCIDJHQgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IEVudmlyb25tZW50IFNpemluZwoKICAtIG5h\
bWU6IHBlcnNpc3RlbnQKICAgIGRlc2NyaXB0aW9uOiBUaGlzIHBsYW4gZGVwbG95cyBhIHBlcnNp\
c3RlbnQgTVMgU1FMIFNlcnZlci4KICAgIGZyZWU6IHRydWUKICAgIG1ldGFkYXRhOgogICAgICBk\
aXNwbGF5TmFtZTogUGVyc2lzdGVudCBpbnN0YWxsYXRpb24KICAgICAgbG9uZ0Rlc2NyaXB0aW9u\
OgogICAgICAgIFRoaXMgcGxhbiB3aWxsIGRlcGxveSBhIHN0YW5kYWxvbmUgTVMgU1FMIFNlcnZl\
ciBvbiBMaW51eAogICAgICAgIHVzaW5nIHBlcnNpc3RlbnQgc3RvcmFnZQogICAgcGFyYW1ldGVy\
czoKICAgICAgLSBuYW1lOiBNU1NRTF9QQVNTV09SRAogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAg\
ICAgICAgZGVmYXVsdDogIkhlbGxvMTIzISIKICAgICAgICBwYXR0ZXJuOiAiXig/Oig/OlthLXpd\
Ky4qW0EtWl0rLiooXFxkfFxcVykrLiopXAogICAgICAgICAgfCg/OltBLVpdKy4qW2Etel0rLioo\
XFxkfFxcVykrLiopXAogICAgICAgICAgfCg/OihcXGR8XFxXKSsuKlthLXpdLipbQS1aXS4qKXwo\
PzooXFxkfFxcVykrLipbQS1aXSsuKlthLXpdKy4qKVwKICAgICAgICAgIHwoPzpbQS1aXSsuKihc\
XGR8XFxXKSsuKlthLXpdKy4qKXwoPzpbYS16XSsuKihcXGR8XFxXKSsuKltBLVpdKy4qKVwKICAg\
ICAgICAgIHwoPzpcXGQrLipcXFcrLiooW0EtWl18W2Etel0pKy4qKXwoPzpcXFcrLipcXGQrLioo\
W0EtWl18W2Etel0pKy4qKVwKICAgICAgICAgIHwoPzooW0EtWl18W2Etel0pKy4qXFxkKy4qXFxX\
Ky4qKXwoPzooW0EtWl18W2Etel0pKy4qXFxXKy4qXFxkKy4qKVwKICAgICAgICAgIHwoPzpcXFcr\
LiooW0EtWl18W2Etel0pKy4qXFxkKy4qKXwoPzpcXGQrLiooW0EtWl18W2Etel0pKy4qXFxXKy4q\
KSkkIgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQK\
ICAgICAgICB0aXRsZTogIlBhc3N3b3JkIGZvciB0aGUgZGF0YWJhc2UgYWRtaW4gKFNBKSB1c2Vy\
LiIKICAgICAgICBkZXNjcmlwdGlvbjoKICAgICAgICAgICJUaGUgcGFzc3dvcmQgbXVzdCBiZSBh\
dCBsZWFzdCA4IGNoYXJhY3RlcnMgbG9uZyBhbmQgY29udGFpbgogICAgICAgICAgY2hhcmFjdGVy\
cyBmcm9tIHRocmVlIG9mIHRoZSBmb2xsb3dpbmcgZm91ciBzZXRzOiBVcHBlcmNhc2UKICAgICAg\
ICAgIGxldHRlcnMsIExvd2VyY2FzZSBsZXR0ZXJzLCBCYXNlIDEwIGRpZ2l0cywgYW5kIFN5bWJv\
bHMuIgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IE1TIFNRTCBDb25maWcKICAgICAgICBtaW5fbGVu\
Z3RoOiA4CiAgICAgICAgbWF4X2xlbmd0aDogMTI4CiAgICAgIC0gbmFtZTogTVNTUUxfREFUQUJB\
U0UKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IFRlc3REQgogICAgICAg\
IHBhdHRlcm46ICJeW2EtekEtWjAtOV8tXSokIgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAg\
IHRpdGxlOiBOYW1lIG9mIHRoZSBNUyBTUUwgZGF0YWJhc2UgYWNjZXNzZWQKICAgICAgICBkaXNw\
bGF5X2dyb3VwOiBNUyBTUUwgQ29uZmlnCiAgICAgIC0gbmFtZTogTVNTUUxfUElECiAgICAgICAg\
cmVxdWlyZWQ6IHRydWUKICAgICAgICB0eXBlOiBlbnVtCiAgICAgICAgZW51bTogWydFdmFsdWF0\
aW9uJywgJ0RldmVsb3BlcicsICdFeHByZXNzJ10KICAgICAgICBkZWZhdWx0OiBEZXZlbG9wZXIK\
ICAgICAgICB0aXRsZTogU2V0IHRoZSBTUUwgU2VydmVyIGVkaXRpb24uCiAgICAgICAgZGlzcGxh\
eV9ncm91cDogTVMgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1TU1FMX0FHRU5UX0VOQUJMRUQK\
ICAgICAgICB0aXRsZTogRW5hYmxlIFNRTCBTZXJ2ZXIgQWdlbnQuCiAgICAgICAgdHlwZTogYm9v\
bGVhbgogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogZmFsc2UKICAgICAg\
ICBkZXNjcmlwdGlvbjogQnkgZGVmYXVsdCwgYWdlbnQgaXMgZGlzYWJsZWQuCiAgICAgICAgZGlz\
cGxheV9ncm91cDogTVMgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1TU1FMX0xDSUQKICAgICAg\
ICB0aXRsZTogU2V0IHRoZSBsYW5ndWFnZSBJRC4KICAgICAgICB0eXBlOiBpbnRlZ2VyCiAgICAg\
ICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiAxMDMzCiAgICAgICAgZGVzY3JpcHRp\
b246IEZvciBleGFtcGxlIC0gMTAzMyBpcyBFbmdsaXNoIChVUyksIDEwMzYgaXMgRnJlbmNoLgog\
ICAgICAgIG1pbl9sZW5ndGg6IDQKICAgICAgICBtYXhfbGVuZ3RoOiA0CiAgICAgICAgZGlzcGxh\
eV9ncm91cDogTVMgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1TU1FMX0lNQUdFX1BVTEwKICAg\
ICAgICB0aXRsZTogIkRlcGxveW1lbnRDb25maWcgSW1hZ2UgcHVsbCBwb2xpY3kiCiAgICAgICAg\
dHlwZTogZW51bQogICAgICAgIGVudW06IFsnQWx3YXlzJywgJ0lmTm90UHJlc2VudCcsICdOZXZl\
ciddCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiBJZk5vdFByZXNlbnQK\
ICAgICAgICBkaXNwbGF5X2dyb3VwOiBNUyBTUUwgQ29uZmlnCiAgICAgIC0gbmFtZTogTVNTUUxf\
REFUQV9TVE9SQUdFX1NJWkUKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6\
IDEKICAgICAgICB0eXBlOiBpbnRlZ2VyCiAgICAgICAgdGl0bGU6IFBlcnNpc3RlbnQgdm9sdW1l\
IHNpemUgZm9yIGRiIGRhdGEgKGluIEdCKSBlZyAxR0IgMkdCCiAgICAgICAgZGlzcGxheV9ncm91\
cDogRW52aXJvbm1lbnQgU2l6aW5nCiAgICAgIC0gbmFtZTogTVNTUUxfTUVNT1JZX0xJTUlUCiAg\
ICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiAzCiAgICAgICAgdHlwZTogaW50\
ZWdlcgogICAgICAgIHRpdGxlOgogICAgICAgICAgTWF4aW11bSBhbW91bnQgb2YgbWVtb3J5IHRo\
ZSBjb250YWluZXIgY2FuIHVzZSAoaW4gR0IpIGVnIDFHQiAyR0IKICAgICAgICBkaXNwbGF5X2dy\
b3VwOiBFbnZpcm9ubWVudCBTaXppbmcKICAgICAgLSBuYW1lOiBNU1NRTF9NRU1PUllfUkVRVUVT\
VAogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogMgogICAgICAgIHR5cGU6\
IGludGVnZXIKICAgICAgICB0aXRsZToKICAgICAgICAgIFJlcXVlc3RlZCBhbW91bnQgb2YgbWVt\
b3J5IGZvciB0aGUgY29udGFpbmVyIHRvIHN0YXJ0IChpbiBHQikKICAgICAgICAgIGVnIDFHQiAy\
R0IKICAgICAgICBkaXNwbGF5X2dyb3VwOiBFbnZpcm9ubWVudCBTaXppbmcK"



COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN yum -y install --setopt=tsflags=nodocs python-pip && \
    yum clean all && \
    chown -R 0 /opt/{ansible,apb} && \
    pip install --upgrade pip && \
    pip install pymssql && \
    chown -R apb:0 /opt/{ansible,apb} && \
    chmod -R g=u /opt/{ansible,apb}
USER apb
