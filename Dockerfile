FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG1zc3FsLXNlcnZlci1hcGIKZGVzY3JpcHRpb246IEFQQiB0byBk\
ZXBsb3kgU1FMIFNlcnZlciBvbiBMaW51eApiaW5kYWJsZTogVHJ1ZQphc3luYzogb3B0aW9uYWwK\
bWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6IFNRTCBTZXJ2ZXIgb24gTGludXggKEFQQikKICBpbWFn\
ZVVybDogaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3RjaHVnaGVzaXYvbXNzcWwt\
c2VydmVyLWFwYi9tYXN0ZXIvZG9jcy9pbWcvc3FsLXNlcnZlci5wbmcKICBkb2N1bWVudGF0aW9u\
VXJsOiBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9zcWwvbGludXgvc3FsLXNlcnZl\
ci1saW51eC1vdmVydmlldwogIHNlcnZpY2VOYW1lOiBtc3NxbC1zZXJ2ZXIKICBkZXBlbmRlbmNp\
ZXM6IFsnZG9ja2VyLmlvL3RjaHVnaGVzaXYvbXNzcWwtc2VydmVyLWxpbnV4J10KdGFnczoKICAt\
IGRhdGFiYXNlCnBsYW5zOgogIC0gbmFtZTogZXBoZW1lcmFsCiAgICBkZXNjcmlwdGlvbjogVGhp\
cyBwbGFuIGRlcGxveXMgYW4gZXBoZW1lcmFsIG1zc3FsLXNlcnZlci4KICAgIGZyZWU6IFRydWUK\
ICAgIGRlZmF1bHQ6IFRydWUKICAgIG1ldGFkYXRhOgogICAgICBkaXNwbGF5TmFtZTogRXBoZW1l\
cmFsIGluc3RhbGxhdGlvbgogICAgICBsb25nRGVzY3JpcHRpb246IFRoaXMgcGxhbiB3aWxsIGRl\
cGxveSBhIE1TIFNRTCBTZXJ2ZXIgc3RhbmRhbG9uZSB1c2luZyBlcGhlbWVyYWwgc3RvcmFnZQog\
ICAgcGFyYW1ldGVyczoKICAgICAgLSBuYW1lOiBNU1NRTF9QQVNTV09SRAogICAgICAgIHJlcXVp\
cmVkOiBUcnVlCiAgICAgICAgZGVmYXVsdDogInlvdXJTdHJvbmdAUGFzc3dvcmQiCiAgICAgICAg\
cGF0dGVybjogIl5bYS16QS1aMC05IUAjJCVeJiorPV17OCx9JCIKICAgICAgICB0eXBlOiBzdHJp\
bmcKICAgICAgICBkaXNwbGF5X3R5cGU6IHBhc3N3b3JkCiAgICAgICAgdGl0bGU6ICJQYXNzd29y\
ZCBmb3IgdGhlIGRhdGFiYXNlIGFkbWluIHVzZXIuIgogICAgICAgIGRlc2NyaXB0aW9uOiAiVGhl\
IHBhc3N3b3JkIHNob3VsZCBmb2xsb3cgdGhlIFNRTCBTZXJ2ZXIgZGVmYXVsdCBwYXNzd29yZCBw\
b2xpY3ksIG90aGVyd2lzZSB0aGUgY29udGFpbmVyIGNhbiBub3Qgc2V0dXAgU1FMIHNlcnZlciBh\
bmQgd2lsbCBzdG9wIHdvcmtpbmcuIEJ5IGRlZmF1bHQsIHRoZSBwYXNzd29yZCBtdXN0IGJlIGF0\
IGxlYXN0IDggY2hhcmFjdGVycyBsb25nIGFuZCBjb250YWluIGNoYXJhY3RlcnMgZnJvbSB0aHJl\
ZSBvZiB0aGUgZm9sbG93aW5nIGZvdXIgc2V0czogVXBwZXJjYXNlIGxldHRlcnMsIExvd2VyY2Fz\
ZSBsZXR0ZXJzLCBCYXNlIDEwIGRpZ2l0cywgYW5kIFN5bWJvbHMuIFlvdSBjYW4gZXhhbWluZSB0\
aGUgZXJyb3IgbG9nIGJ5IGV4ZWN1dGluZyB0aGUgZG9ja2VyIGxvZ3MgY29tbWFuZC4iCiAgICAg\
ICAgZGlzcGxheV9ncm91cDogTVMgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1TU1FMX0RBVEFC\
QVNFCiAgICAgICAgcmVxdWlyZWQ6IFRydWUKICAgICAgICBkZWZhdWx0OiBzYW1wbGVkYgogICAg\
ICAgIHBhdHRlcm46ICJeW2EtekEtWjAtOV8tXSokIgogICAgICAgIHR5cGU6IHN0cmluZwogICAg\
ICAgIHRpdGxlOiBOYW1lIG9mIHRoZSBNUyBTUUwgZGF0YWJhc2UgYWNjZXNzZWQKICAgICAgICBk\
aXNwbGF5X2dyb3VwOiBNUyBTUUwgQ29uZmlnCiAgICAgIC0gbmFtZTogTVNTUUxfTUVNT1JZX0xJ\
TUlUCiAgICAgICAgZGVmYXVsdDogMkdpCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgdGl0\
bGU6IE1heGltdW0gYW1vdW50IG9mIG1lbW9yeSB0aGUgY29udGFpbmVyIGNhbiB1c2UgZWcgNTEy\
TWkgMUdpCiAgICAgICAgZGlzcGxheV9ncm91cDogRW52aXJvbm1lbnQgU2l6aW5nCiAgICAgIC0g\
bmFtZTogTVNTUUxfTUVNT1JZX1JFUVVFU1QKICAgICAgICBkZWZhdWx0OiAxR2kKICAgICAgICB0\
eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTogUmVxdWVzdGVkIGFtb3VudCBvZiBtZW1vcnkgZm9y\
IHRoZSBjb250YWluZXIgdG8gc3RhcnQgZWcgMUdpIDJHaQogICAgICAgIGRpc3BsYXlfZ3JvdXA6\
IEVudmlyb25tZW50IFNpemluZwo="

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN yum -y install --setopt=tsflags=nodocs python-pip && \
    yum clean all && \
    chown -R 0 /opt/{ansible,apb} && \
    pip install --upgrade pip && \
    pip install pymssql && \
    chown -R apb:0 /opt/{ansible,apb} && \
    chmod -R g=u /opt/{ansible,apb}
USER apb
