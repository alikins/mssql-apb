FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"LS0tCnZlcnNpb246IDEuMApuYW1lOiBtc3NxbC1hcGIKZGVzY3JpcHRpb246IEFQQiB0byBkZXBs\
b3kgTWljcm9zb2Z0IFNRTCBTZXJ2ZXIgb24gTGludXggMjAxNyBEZXZlbG9wZXIgRWRpdGlvbgpi\
aW5kYWJsZTogdHJ1ZQphc3luYzogb3B0aW9uYWwKbWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6IE1T\
IFNRTCBTZXJ2ZXIgb24gTGludXggKEFQQikKICBpbWFnZVVybDoKICAgIGh0dHBzOi8vcmF3Lmdp\
dGh1YnVzZXJjb250ZW50LmNvbS9hbnNpYmxlcGxheWJvb2tidW5kbGUvbXNzcWwtYXBiL21hc3Rl\
ci9kb2NzL2ltZy9zcWwtc2VydmVyLnBuZwogIGRvY3VtZW50YXRpb25Vcmw6CiAgICBodHRwczov\
L2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9zcWwvbGludXgvc3FsLXNlcnZlci1saW51eC1vdmVy\
dmlldwogIGRlcGVuZGVuY2llczogWydkb2NrZXIuaW8vdGNodWdoZXNpdi9tc3NxbC1zZXJ2ZXIt\
bGludXgnXQp0YWdzOgogIC0gZGF0YWJhc2UKcGxhbnM6CiAgLSBuYW1lOiBlcGhlbWVyYWwKICAg\
IGRlc2NyaXB0aW9uOiBUaGlzIHBsYW4gZGVwbG95cyBhbiBlcGhlbWVyYWwgTVMgU1FMIFNlcnZl\
ci4KICAgIGZyZWU6IHRydWUKICAgIGRlZmF1bHQ6IHRydWUKICAgIG1ldGFkYXRhOgogICAgICBk\
aXNwbGF5TmFtZTogRXBoZW1lcmFsIGluc3RhbGxhdGlvbgogICAgICBsb25nRGVzY3JpcHRpb246\
CiAgICAgICAgVGhpcyBwbGFuIHdpbGwgZGVwbG95IGEgc3RhbmRhbG9uZSBNUyBTUUwgU2VydmVy\
IG9uIExpbnV4CiAgICAgICAgdXNpbmcgZXBoZW1lcmFsIHN0b3JhZ2UKICAgIHBhcmFtZXRlcnM6\
CiAgICAgIC0gbmFtZTogTVNTUUxfUEFTU1dPUkQKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAg\
ICAgIGRlZmF1bHQ6ICJ5b3VyU3Ryb25nQFBhc3N3b3JkIgogICAgICAgIHBhdHRlcm46ICJeKD86\
KD86W2Etel0rLipbQS1aXSsuKihcXGR8XFxXKSsuKilcCiAgICAgICAgICB8KD86W0EtWl0rLipb\
YS16XSsuKihcXGR8XFxXKSsuKilcCiAgICAgICAgICB8KD86KFxcZHxcXFcpKy4qW2Etel0uKltB\
LVpdLiopfCg/OihcXGR8XFxXKSsuKltBLVpdKy4qW2Etel0rLiopXAogICAgICAgICAgfCg/OltB\
LVpdKy4qKFxcZHxcXFcpKy4qW2Etel0rLiopfCg/OlthLXpdKy4qKFxcZHxcXFcpKy4qW0EtWl0r\
LiopXAogICAgICAgICAgfCg/OlxcZCsuKlxcVysuKihbQS1aXXxbYS16XSkrLiopfCg/OlxcVysu\
KlxcZCsuKihbQS1aXXxbYS16XSkrLiopXAogICAgICAgICAgfCg/OihbQS1aXXxbYS16XSkrLipc\
XGQrLipcXFcrLiopfCg/OihbQS1aXXxbYS16XSkrLipcXFcrLipcXGQrLiopXAogICAgICAgICAg\
fCg/OlxcVysuKihbQS1aXXxbYS16XSkrLipcXGQrLiopfCg/OlxcZCsuKihbQS1aXXxbYS16XSkr\
LipcXFcrLiopKSQiCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGlzcGxheV90eXBlOiBw\
YXNzd29yZAogICAgICAgIHRpdGxlOiAiUGFzc3dvcmQgZm9yIHRoZSBkYXRhYmFzZSBhZG1pbiAo\
U0EpIHVzZXIuIgogICAgICAgIGRlc2NyaXB0aW9uOgogICAgICAgICAgIlRoZSBwYXNzd29yZCBt\
dXN0IGJlIGF0IGxlYXN0IDggY2hhcmFjdGVycyBsb25nIGFuZCBjb250YWluCiAgICAgICAgICBj\
aGFyYWN0ZXJzIGZyb20gdGhyZWUgb2YgdGhlIGZvbGxvd2luZyBmb3VyIHNldHM6IFVwcGVyY2Fz\
ZQogICAgICAgICAgbGV0dGVycywgTG93ZXJjYXNlIGxldHRlcnMsIEJhc2UgMTAgZGlnaXRzLCBh\
bmQgU3ltYm9scy4gWW91CiAgICAgICAgICBjYW4gZXhhbWluZSB0aGUgZXJyb3IgbG9nIGJ5IGV4\
ZWN1dGluZyB0aGUgZG9ja2VyIGxvZ3MgY29tbWFuZC4iCiAgICAgICAgZGlzcGxheV9ncm91cDog\
TVMgU1FMIENvbmZpZwogICAgICAgIG1pbl9sZW5ndGg6IDgKICAgICAgICBtYXhfbGVuZ3RoOiAx\
MjgKICAgICAgLSBuYW1lOiBNU1NRTF9EQVRBQkFTRQogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAg\
ICAgICAgZGVmYXVsdDogc2FtcGxlZGIKICAgICAgICBwYXR0ZXJuOiAiXlthLXpBLVowLTlfLV0q\
JCIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTogTmFtZSBvZiB0aGUgTVMgU1FM\
IGRhdGFiYXNlIGFjY2Vzc2VkCiAgICAgICAgZGlzcGxheV9ncm91cDogTVMgU1FMIENvbmZpZwog\
ICAgICAtIG5hbWU6IE1TU1FMX01FTU9SWV9MSU1JVAogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAg\
ICAgICAgZGVmYXVsdDogMgogICAgICAgIHR5cGU6IGludGVnZXIKICAgICAgICB0aXRsZToKICAg\
ICAgICAgIE1heGltdW0gYW1vdW50IG9mIG1lbW9yeSB0aGUgY29udGFpbmVyIGNhbiB1c2UgKGlu\
IEdpKSBlZyA1MTJNaSAxR2kKICAgICAgICBkaXNwbGF5X2dyb3VwOiBFbnZpcm9ubWVudCBTaXpp\
bmcKICAgICAgLSBuYW1lOiBNU1NRTF9NRU1PUllfUkVRVUVTVAogICAgICAgIHJlcXVpcmVkOiB0\
cnVlCiAgICAgICAgZGVmYXVsdDogMQogICAgICAgIHR5cGU6IGludGVnZXIKICAgICAgICB0aXRs\
ZToKICAgICAgICAgIFJlcXVlc3RlZCBhbW91bnQgb2YgbWVtb3J5IGZvciB0aGUgY29udGFpbmVy\
IHRvIHN0YXJ0IChpbiBHaSkKICAgICAgICAgIGVnIDFHaSAyR2kKICAgICAgICBkaXNwbGF5X2dy\
b3VwOiBFbnZpcm9ubWVudCBTaXppbmcKCiAgLSBuYW1lOiBwZXJzaXN0ZW50CiAgICBkZXNjcmlw\
dGlvbjogVGhpcyBwbGFuIGRlcGxveXMgYSBwZXJzaXN0ZW50IE1TIFNRTCBTZXJ2ZXIuCiAgICBm\
cmVlOiB0cnVlCiAgICBkZWZhdWx0OiBmYWxzZQogICAgbWV0YWRhdGE6CiAgICAgIGRpc3BsYXlO\
YW1lOiBQZXJzaXN0ZW50IGluc3RhbGxhdGlvbgogICAgICBsb25nRGVzY3JpcHRpb246CiAgICAg\
ICAgVGhpcyBwbGFuIHdpbGwgZGVwbG95IGEgc3RhbmRhbG9uZSBNUyBTUUwgU2VydmVyIG9uIExp\
bnV4CiAgICAgICAgdXNpbmcgcGVyc2lzdGVudCBzdG9yYWdlCiAgICBwYXJhbWV0ZXJzOgogICAg\
ICAtIG5hbWU6IE1TU1FMX1BBU1NXT1JECiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBk\
ZWZhdWx0OiAieW91clN0cm9uZ0BQYXNzd29yZCIKICAgICAgICBwYXR0ZXJuOiAiXig/Oig/Olth\
LXpdKy4qW0EtWl0rLiooXFxkfFxcVykrLiopXAogICAgICAgICAgfCg/OltBLVpdKy4qW2Etel0r\
LiooXFxkfFxcVykrLiopXAogICAgICAgICAgfCg/OihcXGR8XFxXKSsuKlthLXpdLipbQS1aXS4q\
KXwoPzooXFxkfFxcVykrLipbQS1aXSsuKlthLXpdKy4qKVwKICAgICAgICAgIHwoPzpbQS1aXSsu\
KihcXGR8XFxXKSsuKlthLXpdKy4qKXwoPzpbYS16XSsuKihcXGR8XFxXKSsuKltBLVpdKy4qKVwK\
ICAgICAgICAgIHwoPzpcXGQrLipcXFcrLiooW0EtWl18W2Etel0pKy4qKXwoPzpcXFcrLipcXGQr\
LiooW0EtWl18W2Etel0pKy4qKVwKICAgICAgICAgIHwoPzooW0EtWl18W2Etel0pKy4qXFxkKy4q\
XFxXKy4qKXwoPzooW0EtWl18W2Etel0pKy4qXFxXKy4qXFxkKy4qKVwKICAgICAgICAgIHwoPzpc\
XFcrLiooW0EtWl18W2Etel0pKy4qXFxkKy4qKXwoPzpcXGQrLiooW0EtWl18W2Etel0pKy4qXFxX\
Ky4qKSkkIgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIGRpc3BsYXlfdHlwZTogcGFzc3dv\
cmQKICAgICAgICB0aXRsZTogIlBhc3N3b3JkIGZvciB0aGUgZGF0YWJhc2UgYWRtaW4gKFNBKSB1\
c2VyLiIKICAgICAgICBkZXNjcmlwdGlvbjoKICAgICAgICAgICJUaGUgcGFzc3dvcmQgbXVzdCBi\
ZSBhdCBsZWFzdCA4IGNoYXJhY3RlcnMgbG9uZyBhbmQgY29udGFpbgogICAgICAgICAgY2hhcmFj\
dGVycyBmcm9tIHRocmVlIG9mIHRoZSBmb2xsb3dpbmcgZm91ciBzZXRzOiBVcHBlcmNhc2UKICAg\
ICAgICAgIGxldHRlcnMsIExvd2VyY2FzZSBsZXR0ZXJzLCBCYXNlIDEwIGRpZ2l0cywgYW5kIFN5\
bWJvbHMuIFlvdQogICAgICAgICAgY2FuIGV4YW1pbmUgdGhlIGVycm9yIGxvZyBieSBleGVjdXRp\
bmcgdGhlIGRvY2tlciBsb2dzIGNvbW1hbmQuIgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IE1TIFNR\
TCBDb25maWcKICAgICAgICBtaW5fbGVuZ3RoOiA4CiAgICAgICAgbWF4X2xlbmd0aDogMTI4CiAg\
ICAgIC0gbmFtZTogTVNTUUxfREFUQUJBU0UKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAg\
IGRlZmF1bHQ6IHNhbXBsZWRiCiAgICAgICAgcGF0dGVybjogIl5bYS16QS1aMC05Xy1dKiQiCiAg\
ICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgdGl0bGU6IE5hbWUgb2YgdGhlIE1TIFNRTCBkYXRh\
YmFzZSBhY2Nlc3NlZAogICAgICAgIGRpc3BsYXlfZ3JvdXA6IE1TIFNRTCBDb25maWcKICAgICAg\
LSBuYW1lOiBNU1NRTF9EQVRBX1NUT1JBR0VfU0laRQogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAg\
ICAgICAgZGVmYXVsdDogMQogICAgICAgIHR5cGU6IGludGVnZXIKICAgICAgICB0aXRsZTogUGVy\
c2lzdGVudCB2b2x1bWUgc2l6ZSBmb3IgZGIgZGF0YSAoaW4gR2kpIGVnIDUxMk1pIDFHaQogICAg\
ICAgIGRpc3BsYXlfZ3JvdXA6IEVudmlyb25tZW50IFNpemluZwogICAgICAtIG5hbWU6IE1TU1FM\
X01FTU9SWV9MSU1JVAogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogMgog\
ICAgICAgIHR5cGU6IGludGVnZXIKICAgICAgICB0aXRsZToKICAgICAgICAgIE1heGltdW0gYW1v\
dW50IG9mIG1lbW9yeSB0aGUgY29udGFpbmVyIGNhbiB1c2UgKGluIEdpKSBlZyA1MTJNaSAxR2kK\
ICAgICAgICBkaXNwbGF5X2dyb3VwOiBFbnZpcm9ubWVudCBTaXppbmcKICAgICAgLSBuYW1lOiBN\
U1NRTF9NRU1PUllfUkVRVUVTVAogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVs\
dDogMQogICAgICAgIHR5cGU6IGludGVnZXIKICAgICAgICB0aXRsZToKICAgICAgICAgIFJlcXVl\
c3RlZCBhbW91bnQgb2YgbWVtb3J5IGZvciB0aGUgY29udGFpbmVyIHRvIHN0YXJ0IChpbiBHaSkK\
ICAgICAgICAgIGVnIDFHaSAyR2kKICAgICAgICBkaXNwbGF5X2dyb3VwOiBFbnZpcm9ubWVudCBT\
aXppbmcK"



COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN yum -y install --setopt=tsflags=nodocs python-pip && \
    yum clean all && \
    chown -R 0 /opt/{ansible,apb} && \
    pip install --upgrade pip && \
    pip install pymssql && \
    chown -R apb:0 /opt/{ansible,apb} && \
    chmod -R g=u /opt/{ansible,apb}
USER apb
