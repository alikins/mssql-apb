FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG1zc3FsLWFwYgpkZXNjcmlwdGlvbjogQVBCIHRvIGRlcGxveSBT\
UUwgU2VydmVyIG9uIExpbnV4CmJpbmRhYmxlOiBUcnVlCmFzeW5jOiBvcHRpb25hbAptZXRhZGF0\
YToKICBkaXNwbGF5TmFtZTogU1FMIFNlcnZlciBvbiBMaW51eCAoQVBCKQogIGltYWdlVXJsOiBo\
dHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vYW5zaWJsZXBsYXlib29rYnVuZGxlL21z\
c3FsLWFwYi9tYXN0ZXIvZG9jcy9pbWcvc3FsLXNlcnZlci5wbmcKICBkb2N1bWVudGF0aW9uVXJs\
OiBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9zcWwvbGludXgvc3FsLXNlcnZlci1s\
aW51eC1vdmVydmlldwogIHNlcnZpY2VOYW1lOiBtc3NxbC1zZXJ2ZXIKICBkZXBlbmRlbmNpZXM6\
IFsnZG9ja2VyLmlvL3RjaHVnaGVzaXYvbXNzcWwtc2VydmVyLWxpbnV4J10KdGFnczoKICAtIGRh\
dGFiYXNlCnBsYW5zOgogIC0gbmFtZTogZXBoZW1lcmFsCiAgICBkZXNjcmlwdGlvbjogVGhpcyBw\
bGFuIGRlcGxveXMgYW4gZXBoZW1lcmFsIG1zc3FsLXNlcnZlci4KICAgIGZyZWU6IFRydWUKICAg\
IGRlZmF1bHQ6IFRydWUKICAgIG1ldGFkYXRhOgogICAgICBkaXNwbGF5TmFtZTogRXBoZW1lcmFs\
IGluc3RhbGxhdGlvbgogICAgICBsb25nRGVzY3JpcHRpb246IFRoaXMgcGxhbiB3aWxsIGRlcGxv\
eSBhIE1TIFNRTCBTZXJ2ZXIgc3RhbmRhbG9uZSB1c2luZyBlcGhlbWVyYWwgc3RvcmFnZQogICAg\
cGFyYW1ldGVyczoKICAgICAgLSBuYW1lOiBNU1NRTF9QQVNTV09SRAogICAgICAgIHJlcXVpcmVk\
OiBUcnVlCiAgICAgICAgZGVmYXVsdDogInlvdXJTdHJvbmdAUGFzc3dvcmQiCiAgICAgICAgcGF0\
dGVybjogIl5bYS16QS1aMC05IUAjJCVeJiorPV17OCx9JCIKICAgICAgICB0eXBlOiBzdHJpbmcK\
ICAgICAgICBkaXNwbGF5X3R5cGU6IHBhc3N3b3JkCiAgICAgICAgdGl0bGU6ICJQYXNzd29yZCBm\
b3IgdGhlIGRhdGFiYXNlIGFkbWluIHVzZXIuIgogICAgICAgIGRlc2NyaXB0aW9uOiAiVGhlIHBh\
c3N3b3JkIHNob3VsZCBmb2xsb3cgdGhlIFNRTCBTZXJ2ZXIgZGVmYXVsdCBwYXNzd29yZCBwb2xp\
Y3ksIG90aGVyd2lzZSB0aGUgY29udGFpbmVyIGNhbiBub3Qgc2V0dXAgU1FMIHNlcnZlciBhbmQg\
d2lsbCBzdG9wIHdvcmtpbmcuIEJ5IGRlZmF1bHQsIHRoZSBwYXNzd29yZCBtdXN0IGJlIGF0IGxl\
YXN0IDggY2hhcmFjdGVycyBsb25nIGFuZCBjb250YWluIGNoYXJhY3RlcnMgZnJvbSB0aHJlZSBv\
ZiB0aGUgZm9sbG93aW5nIGZvdXIgc2V0czogVXBwZXJjYXNlIGxldHRlcnMsIExvd2VyY2FzZSBs\
ZXR0ZXJzLCBCYXNlIDEwIGRpZ2l0cywgYW5kIFN5bWJvbHMuIFlvdSBjYW4gZXhhbWluZSB0aGUg\
ZXJyb3IgbG9nIGJ5IGV4ZWN1dGluZyB0aGUgZG9ja2VyIGxvZ3MgY29tbWFuZC4iCiAgICAgICAg\
ZGlzcGxheV9ncm91cDogTVMgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1TU1FMX0RBVEFCQVNF\
CiAgICAgICAgcmVxdWlyZWQ6IFRydWUKICAgICAgICBkZWZhdWx0OiBzYW1wbGVkYgogICAgICAg\
IHBhdHRlcm46ICJeW2EtekEtWjAtOV8tXSokIgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAg\
IHRpdGxlOiBOYW1lIG9mIHRoZSBNUyBTUUwgZGF0YWJhc2UgYWNjZXNzZWQKICAgICAgICBkaXNw\
bGF5X2dyb3VwOiBNUyBTUUwgQ29uZmlnCiAgICAgIC0gbmFtZTogTVNTUUxfTUVNT1JZX0xJTUlU\
CiAgICAgICAgZGVmYXVsdDogMkdpCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgdGl0bGU6\
IE1heGltdW0gYW1vdW50IG9mIG1lbW9yeSB0aGUgY29udGFpbmVyIGNhbiB1c2UgZWcgNTEyTWkg\
MUdpCiAgICAgICAgZGlzcGxheV9ncm91cDogRW52aXJvbm1lbnQgU2l6aW5nCiAgICAgIC0gbmFt\
ZTogTVNTUUxfTUVNT1JZX1JFUVVFU1QKICAgICAgICBkZWZhdWx0OiAxR2kKICAgICAgICB0eXBl\
OiBzdHJpbmcKICAgICAgICB0aXRsZTogUmVxdWVzdGVkIGFtb3VudCBvZiBtZW1vcnkgZm9yIHRo\
ZSBjb250YWluZXIgdG8gc3RhcnQgZWcgMUdpIDJHaQogICAgICAgIGRpc3BsYXlfZ3JvdXA6IEVu\
dmlyb25tZW50IFNpemluZwo="

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN yum -y install --setopt=tsflags=nodocs python-pip && \
    yum clean all && \
    chown -R 0 /opt/{ansible,apb} && \
    pip install --upgrade pip && \
    pip install pymssql && \
    chown -R apb:0 /opt/{ansible,apb} && \
    chmod -R g=u /opt/{ansible,apb}
USER apb
