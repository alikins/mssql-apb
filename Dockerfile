FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"LS0tCnZlcnNpb246IDEuMApuYW1lOiBtc3NxbC1hcGIKZGVzY3JpcHRpb246IEFQQiB0byBkZXBs\
b3kgTWljcm9zb2Z0IFNRTCBTZXJ2ZXIgb24gTGludXggMjAxNwpiaW5kYWJsZTogdHJ1ZQphc3lu\
Yzogb3B0aW9uYWwKbWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6IE1TIFNRTCBTZXJ2ZXIgb24gTGlu\
dXggKEFQQikKICBpbWFnZVVybDoKICAgIGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNv\
bS9hbnNpYmxlcGxheWJvb2tidW5kbGUvbXNzcWwtYXBiL21hc3Rlci9kb2NzL2ltZy9zcWwtc2Vy\
dmVyLnBuZwogIGRvY3VtZW50YXRpb25Vcmw6CiAgICBodHRwczovL2RvY3MubWljcm9zb2Z0LmNv\
bS9lbi11cy9zcWwvbGludXgvc3FsLXNlcnZlci1saW51eC1vdmVydmlldwogIGRlcGVuZGVuY2ll\
czogWydkb2NrZXIuaW8vdGNodWdoZXNpdi9tc3NxbC1zZXJ2ZXItbGludXgnXQp0YWdzOgogIC0g\
ZGF0YWJhc2UKICAtIG1zc3FsCnBsYW5zOgogIC0gbmFtZTogZXBoZW1lcmFsCiAgICBkZXNjcmlw\
dGlvbjogVGhpcyBwbGFuIGRlcGxveXMgYW4gZXBoZW1lcmFsIE1TIFNRTCBTZXJ2ZXIuCiAgICBm\
cmVlOiB0cnVlCiAgICBkZWZhdWx0OiB0cnVlCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5h\
bWU6IEVwaGVtZXJhbCBpbnN0YWxsYXRpb24KICAgICAgbG9uZ0Rlc2NyaXB0aW9uOgogICAgICAg\
IFRoaXMgcGxhbiB3aWxsIGRlcGxveSBhIHN0YW5kYWxvbmUgTVMgU1FMIFNlcnZlciBvbiBMaW51\
eAogICAgICAgIHVzaW5nIGVwaGVtZXJhbCBzdG9yYWdlCiAgICBwYXJhbWV0ZXJzOgogICAgICAt\
IG5hbWU6IE1TU1FMX1BBU1NXT1JECiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZh\
dWx0OiAiSGVsbG8xMjMhIgogICAgICAgIHBhdHRlcm46ICJeKD86KD86W2Etel0rLipbQS1aXSsu\
KihcXGR8XFxXKSsuKilcCiAgICAgICAgICB8KD86W0EtWl0rLipbYS16XSsuKihcXGR8XFxXKSsu\
KilcCiAgICAgICAgICB8KD86KFxcZHxcXFcpKy4qW2Etel0uKltBLVpdLiopfCg/OihcXGR8XFxX\
KSsuKltBLVpdKy4qW2Etel0rLiopXAogICAgICAgICAgfCg/OltBLVpdKy4qKFxcZHxcXFcpKy4q\
W2Etel0rLiopfCg/OlthLXpdKy4qKFxcZHxcXFcpKy4qW0EtWl0rLiopXAogICAgICAgICAgfCg/\
OlxcZCsuKlxcVysuKihbQS1aXXxbYS16XSkrLiopfCg/OlxcVysuKlxcZCsuKihbQS1aXXxbYS16\
XSkrLiopXAogICAgICAgICAgfCg/OihbQS1aXXxbYS16XSkrLipcXGQrLipcXFcrLiopfCg/Oihb\
QS1aXXxbYS16XSkrLipcXFcrLipcXGQrLiopXAogICAgICAgICAgfCg/OlxcVysuKihbQS1aXXxb\
YS16XSkrLipcXGQrLiopfCg/OlxcZCsuKihbQS1aXXxbYS16XSkrLipcXFcrLiopKSQiCiAgICAg\
ICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICAgIHRp\
dGxlOiAiUGFzc3dvcmQgZm9yIHRoZSBkYXRhYmFzZSBhZG1pbiAoU0EpIHVzZXIuIgogICAgICAg\
IGRlc2NyaXB0aW9uOgogICAgICAgICAgIlRoZSBwYXNzd29yZCBtdXN0IGJlIGF0IGxlYXN0IDgg\
Y2hhcmFjdGVycyBsb25nIGFuZCBjb250YWluCiAgICAgICAgICBjaGFyYWN0ZXJzIGZyb20gdGhy\
ZWUgb2YgdGhlIGZvbGxvd2luZyBmb3VyIHNldHM6IFVwcGVyY2FzZQogICAgICAgICAgbGV0dGVy\
cywgTG93ZXJjYXNlIGxldHRlcnMsIEJhc2UgMTAgZGlnaXRzLCBhbmQgU3ltYm9scy4iCiAgICAg\
ICAgZGlzcGxheV9ncm91cDogTVMgU1FMIENvbmZpZwogICAgICAgIG1pbl9sZW5ndGg6IDgKICAg\
ICAgICBtYXhfbGVuZ3RoOiAxMjgKICAgICAgLSBuYW1lOiBNU1NRTF9EQVRBQkFTRQogICAgICAg\
IHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogVGVzdERCCiAgICAgICAgcGF0dGVybjog\
Il5bYS16QS1aMC05Xy1dKiQiCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgdGl0bGU6IE5h\
bWUgb2YgdGhlIE1TIFNRTCBkYXRhYmFzZSB0byBjcmVhdGUuCiAgICAgICAgZGlzcGxheV9ncm91\
cDogTVMgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1TU1FMX1BJRAogICAgICAgIHJlcXVpcmVk\
OiB0cnVlCiAgICAgICAgdHlwZTogZW51bQogICAgICAgIGVudW06IFsnRGV2ZWxvcGVyJywgJ0V2\
YWx1YXRpb24nXQogICAgICAgIGRlZmF1bHQ6IERldmVsb3BlcgogICAgICAgIHRpdGxlOiBTZXQg\
dGhlIFNRTCBTZXJ2ZXIgZWRpdGlvbi4KICAgICAgICBkaXNwbGF5X2dyb3VwOiBNUyBTUUwgQ29u\
ZmlnCiAgICAgIC0gbmFtZTogTVNTUUxfQUdFTlRfRU5BQkxFRAogICAgICAgIHRpdGxlOiBFbmFi\
bGUgU1FMIFNlcnZlciBBZ2VudC4KICAgICAgICB0eXBlOiBib29sZWFuCiAgICAgICAgcmVxdWly\
ZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiBmYWxzZQogICAgICAgIGRlc2NyaXB0aW9uOiBCeSBk\
ZWZhdWx0LCBhZ2VudCBpcyBkaXNhYmxlZC4KICAgICAgICBkaXNwbGF5X2dyb3VwOiBNUyBTUUwg\
Q29uZmlnCiAgICAgIC0gbmFtZTogTVNTUUxfTENJRAogICAgICAgIHRpdGxlOiBTZXQgdGhlIGxh\
bmd1YWdlIElELgogICAgICAgIHR5cGU6IGludGVnZXIKICAgICAgICByZXF1aXJlZDogdHJ1ZQog\
ICAgICAgIGRlZmF1bHQ6IDEwMzMKICAgICAgICBkZXNjcmlwdGlvbjogRm9yIGV4YW1wbGUgLSAx\
MDMzIGlzIEVuZ2xpc2ggKFVTKSwgMTAzNiBpcyBGcmVuY2guCiAgICAgICAgbWluX2xlbmd0aDog\
NAogICAgICAgIG1heF9sZW5ndGg6IDQKICAgICAgICBkaXNwbGF5X2dyb3VwOiBNUyBTUUwgQ29u\
ZmlnCiAgICAgIC0gbmFtZTogTVNTUUxfSU1BR0VfUFVMTAogICAgICAgIHRpdGxlOiAiRGVwbG95\
bWVudENvbmZpZyBJbWFnZSBwdWxsIHBvbGljeSIKICAgICAgICB0eXBlOiBlbnVtCiAgICAgICAg\
ZW51bTogWydBbHdheXMnLCAnSWZOb3RQcmVzZW50JywgJ05ldmVyJ10KICAgICAgICByZXF1aXJl\
ZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IElmTm90UHJlc2VudAogICAgICAgIGRpc3BsYXlfZ3Jv\
dXA6IE1TIFNRTCBDb25maWcKICAgICAgLSBuYW1lOiBNU1NRTF9TQ0hFRFVMRUQKICAgICAgICB0\
aXRsZTogIkltYWdlU3RyZWFtIEltcG9ydFBvbGljeSBTY2hlZHVsZWQiCiAgICAgICAgdHlwZTog\
Ym9vbGVhbgogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogdHJ1ZQogICAg\
ICAgIGRpc3BsYXlfZ3JvdXA6IE1TIFNRTCBDb25maWcKICAgICAgLSBuYW1lOiBNU1NRTF9NRU1P\
UllfTElNSVQKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IDMKICAgICAg\
ICB0eXBlOiBpbnRlZ2VyCiAgICAgICAgdGl0bGU6CiAgICAgICAgICBNYXhpbXVtIGFtb3VudCBv\
ZiBtZW1vcnkgdGhlIGNvbnRhaW5lciBjYW4gdXNlIChpbiBHQikgZWcgMUdCIDJHQgogICAgICAg\
IGRpc3BsYXlfZ3JvdXA6IEVudmlyb25tZW50IFNpemluZwogICAgICAtIG5hbWU6IE1TU1FMX01F\
TU9SWV9SRVFVRVNUCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiAyCiAg\
ICAgICAgdHlwZTogaW50ZWdlcgogICAgICAgIHRpdGxlOgogICAgICAgICAgUmVxdWVzdGVkIGFt\
b3VudCBvZiBtZW1vcnkgZm9yIHRoZSBjb250YWluZXIgdG8gc3RhcnQgKGluIEdCKQogICAgICAg\
ICAgZWcgMUdCIDJHQgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IEVudmlyb25tZW50IFNpemluZwoK\
ICAtIG5hbWU6IHBlcnNpc3RlbnQKICAgIGRlc2NyaXB0aW9uOiBUaGlzIHBsYW4gZGVwbG95cyBh\
IHBlcnNpc3RlbnQgTVMgU1FMIFNlcnZlci4KICAgIGZyZWU6IHRydWUKICAgIG1ldGFkYXRhOgog\
ICAgICBkaXNwbGF5TmFtZTogUGVyc2lzdGVudCBpbnN0YWxsYXRpb24KICAgICAgbG9uZ0Rlc2Ny\
aXB0aW9uOgogICAgICAgIFRoaXMgcGxhbiB3aWxsIGRlcGxveSBhIHN0YW5kYWxvbmUgTVMgU1FM\
IFNlcnZlciBvbiBMaW51eAogICAgICAgIHVzaW5nIHBlcnNpc3RlbnQgc3RvcmFnZQogICAgcGFy\
YW1ldGVyczoKICAgICAgLSBuYW1lOiBNU1NRTF9QQVNTV09SRAogICAgICAgIHJlcXVpcmVkOiB0\
cnVlCiAgICAgICAgZGVmYXVsdDogIkhlbGxvMTIzISIKICAgICAgICBwYXR0ZXJuOiAiXig/Oig/\
OlthLXpdKy4qW0EtWl0rLiooXFxkfFxcVykrLiopXAogICAgICAgICAgfCg/OltBLVpdKy4qW2Et\
el0rLiooXFxkfFxcVykrLiopXAogICAgICAgICAgfCg/OihcXGR8XFxXKSsuKlthLXpdLipbQS1a\
XS4qKXwoPzooXFxkfFxcVykrLipbQS1aXSsuKlthLXpdKy4qKVwKICAgICAgICAgIHwoPzpbQS1a\
XSsuKihcXGR8XFxXKSsuKlthLXpdKy4qKXwoPzpbYS16XSsuKihcXGR8XFxXKSsuKltBLVpdKy4q\
KVwKICAgICAgICAgIHwoPzpcXGQrLipcXFcrLiooW0EtWl18W2Etel0pKy4qKXwoPzpcXFcrLipc\
XGQrLiooW0EtWl18W2Etel0pKy4qKVwKICAgICAgICAgIHwoPzooW0EtWl18W2Etel0pKy4qXFxk\
Ky4qXFxXKy4qKXwoPzooW0EtWl18W2Etel0pKy4qXFxXKy4qXFxkKy4qKVwKICAgICAgICAgIHwo\
PzpcXFcrLiooW0EtWl18W2Etel0pKy4qXFxkKy4qKXwoPzpcXGQrLiooW0EtWl18W2Etel0pKy4q\
XFxXKy4qKSkkIgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIGRpc3BsYXlfdHlwZTogcGFz\
c3dvcmQKICAgICAgICB0aXRsZTogIlBhc3N3b3JkIGZvciB0aGUgZGF0YWJhc2UgYWRtaW4gKFNB\
KSB1c2VyLiIKICAgICAgICBkZXNjcmlwdGlvbjoKICAgICAgICAgICJUaGUgcGFzc3dvcmQgbXVz\
dCBiZSBhdCBsZWFzdCA4IGNoYXJhY3RlcnMgbG9uZyBhbmQgY29udGFpbgogICAgICAgICAgY2hh\
cmFjdGVycyBmcm9tIHRocmVlIG9mIHRoZSBmb2xsb3dpbmcgZm91ciBzZXRzOiBVcHBlcmNhc2UK\
ICAgICAgICAgIGxldHRlcnMsIExvd2VyY2FzZSBsZXR0ZXJzLCBCYXNlIDEwIGRpZ2l0cywgYW5k\
IFN5bWJvbHMuIgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IE1TIFNRTCBDb25maWcKICAgICAgICBt\
aW5fbGVuZ3RoOiA4CiAgICAgICAgbWF4X2xlbmd0aDogMTI4CiAgICAgIC0gbmFtZTogTVNTUUxf\
REFUQUJBU0UKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IFRlc3REQgog\
ICAgICAgIHBhdHRlcm46ICJeW2EtekEtWjAtOV8tXSokIgogICAgICAgIHR5cGU6IHN0cmluZwog\
ICAgICAgIHRpdGxlOiBOYW1lIG9mIHRoZSBNUyBTUUwgZGF0YWJhc2UgdG8gY3JlYXRlLgogICAg\
ICAgIGRpc3BsYXlfZ3JvdXA6IE1TIFNRTCBDb25maWcKICAgICAgLSBuYW1lOiBNU1NRTF9QSUQK\
ICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIHR5cGU6IGVudW0KICAgICAgICBlbnVtOiBb\
J0RldmVsb3BlcicsICdFdmFsdWF0aW9uJ10KICAgICAgICBkZWZhdWx0OiBEZXZlbG9wZXIKICAg\
ICAgICB0aXRsZTogU2V0IHRoZSBTUUwgU2VydmVyIGVkaXRpb24uCiAgICAgICAgZGlzcGxheV9n\
cm91cDogTVMgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1TU1FMX0FHRU5UX0VOQUJMRUQKICAg\
ICAgICB0aXRsZTogRW5hYmxlIFNRTCBTZXJ2ZXIgQWdlbnQuCiAgICAgICAgdHlwZTogYm9vbGVh\
bgogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogZmFsc2UKICAgICAgICBk\
ZXNjcmlwdGlvbjogQnkgZGVmYXVsdCwgYWdlbnQgaXMgZGlzYWJsZWQuCiAgICAgICAgZGlzcGxh\
eV9ncm91cDogTVMgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1TU1FMX0xDSUQKICAgICAgICB0\
aXRsZTogU2V0IHRoZSBsYW5ndWFnZSBJRC4KICAgICAgICB0eXBlOiBpbnRlZ2VyCiAgICAgICAg\
cmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiAxMDMzCiAgICAgICAgZGVzY3JpcHRpb246\
IEZvciBleGFtcGxlIC0gMTAzMyBpcyBFbmdsaXNoIChVUyksIDEwMzYgaXMgRnJlbmNoLgogICAg\
ICAgIG1pbl9sZW5ndGg6IDQKICAgICAgICBtYXhfbGVuZ3RoOiA0CiAgICAgICAgZGlzcGxheV9n\
cm91cDogTVMgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1TU1FMX0lNQUdFX1BVTEwKICAgICAg\
ICB0aXRsZTogIkRlcGxveW1lbnRDb25maWcgSW1hZ2UgcHVsbCBwb2xpY3kiCiAgICAgICAgdHlw\
ZTogZW51bQogICAgICAgIGVudW06IFsnQWx3YXlzJywgJ0lmTm90UHJlc2VudCcsICdOZXZlcidd\
CiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiBJZk5vdFByZXNlbnQKICAg\
ICAgICBkaXNwbGF5X2dyb3VwOiBNUyBTUUwgQ29uZmlnCiAgICAgIC0gbmFtZTogTVNTUUxfU0NI\
RURVTEVECiAgICAgICAgdGl0bGU6ICJJbWFnZVN0cmVhbSBJbXBvcnRQb2xpY3kgU2NoZWR1bGVk\
IgogICAgICAgIHR5cGU6IGJvb2xlYW4KICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRl\
ZmF1bHQ6IHRydWUKICAgICAgICBkaXNwbGF5X2dyb3VwOiBNUyBTUUwgQ29uZmlnCiAgICAgIC0g\
bmFtZTogTVNTUUxfREFUQV9TVE9SQUdFX1NJWkUKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAg\
ICAgIGRlZmF1bHQ6IDEKICAgICAgICB0eXBlOiBpbnRlZ2VyCiAgICAgICAgdGl0bGU6IFBlcnNp\
c3RlbnQgdm9sdW1lIHNpemUgZm9yIGRiIGRhdGEgKGluIEdCKSBlZyAxR0IgMkdCCiAgICAgICAg\
ZGlzcGxheV9ncm91cDogRW52aXJvbm1lbnQgU2l6aW5nCiAgICAgIC0gbmFtZTogTVNTUUxfTUVN\
T1JZX0xJTUlUCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiAzCiAgICAg\
ICAgdHlwZTogaW50ZWdlcgogICAgICAgIHRpdGxlOgogICAgICAgICAgTWF4aW11bSBhbW91bnQg\
b2YgbWVtb3J5IHRoZSBjb250YWluZXIgY2FuIHVzZSAoaW4gR0IpIGVnIDFHQiAyR0IKICAgICAg\
ICBkaXNwbGF5X2dyb3VwOiBFbnZpcm9ubWVudCBTaXppbmcKICAgICAgLSBuYW1lOiBNU1NRTF9N\
RU1PUllfUkVRVUVTVAogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogMgog\
ICAgICAgIHR5cGU6IGludGVnZXIKICAgICAgICB0aXRsZToKICAgICAgICAgIFJlcXVlc3RlZCBh\
bW91bnQgb2YgbWVtb3J5IGZvciB0aGUgY29udGFpbmVyIHRvIHN0YXJ0IChpbiBHQikKICAgICAg\
ICAgIGVnIDFHQiAyR0IKICAgICAgICBkaXNwbGF5X2dyb3VwOiBFbnZpcm9ubWVudCBTaXppbmcK"

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN yum -y install --setopt=tsflags=nodocs python-pip && \
    yum clean all && \
    chown -R 0 /opt/{ansible,apb} && \
    pip install --upgrade pip && \
    pip install pymssql && \
    chown -R apb:0 /opt/{ansible,apb} && \
    chmod -R g=u /opt/{ansible,apb}
USER apb
