FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"LS0tCnZlcnNpb246IDEuMApuYW1lOiBtc3NxbC1hcGIKZGVzY3JpcHRpb246IEFQQiB0byBkZXBs\
b3kgTWljcm9zb2Z0IFNRTCBTZXJ2ZXIgb24gTGludXggMjAxNyBEZXZlbG9wZXIgRWRpdGlvbgpi\
aW5kYWJsZTogdHJ1ZQphc3luYzogb3B0aW9uYWwKbWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6IE1T\
IFNRTCBTZXJ2ZXIgb24gTGludXggKEFQQikKICBpbWFnZVVybDoKICAgIGh0dHBzOi8vcmF3Lmdp\
dGh1YnVzZXJjb250ZW50LmNvbS9hbnNpYmxlcGxheWJvb2tidW5kbGUvbXNzcWwtYXBiL21hc3Rl\
ci9kb2NzL2ltZy9zcWwtc2VydmVyLnBuZwogIGRvY3VtZW50YXRpb25Vcmw6CiAgICBodHRwczov\
L2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9zcWwvbGludXgvc3FsLXNlcnZlci1saW51eC1vdmVy\
dmlldwogIGRlcGVuZGVuY2llczogWydkb2NrZXIuaW8vdGNodWdoZXNpdi9tc3NxbC1zZXJ2ZXIt\
bGludXgnXQp0YWdzOgogIC0gZGF0YWJhc2UKcGxhbnM6CiAgLSBuYW1lOiBlcGhlbWVyYWwKICAg\
IGRlc2NyaXB0aW9uOiBUaGlzIHBsYW4gZGVwbG95cyBhbiBlcGhlbWVyYWwgTVMgU1FMIFNlcnZl\
ci4KICAgIGZyZWU6IHRydWUKICAgIGRlZmF1bHQ6IHRydWUKICAgIG1ldGFkYXRhOgogICAgICBk\
aXNwbGF5TmFtZTogRXBoZW1lcmFsIGluc3RhbGxhdGlvbgogICAgICBsb25nRGVzY3JpcHRpb246\
CiAgICAgICAgVGhpcyBwbGFuIHdpbGwgZGVwbG95IGEgc3RhbmRhbG9uZSBNUyBTUUwgU2VydmVy\
IG9uIExpbnV4CiAgICAgICAgdXNpbmcgZXBoZW1lcmFsIHN0b3JhZ2UKICAgIHBhcmFtZXRlcnM6\
CiAgICAgIC0gbmFtZTogTVNTUUxfUEFTU1dPUkQKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAg\
ICAgIGRlZmF1bHQ6ICJ5b3VyU3Ryb25nQFBhc3N3b3JkIgogICAgICAgIHBhdHRlcm46ICJeKD86\
KD86W2Etel0rLipbQS1aXSsuKihcXGR8XFxXKSsuKilcCiAgICAgICAgICB8KD86W0EtWl0rLipb\
YS16XSsuKihcXGR8XFxXKSsuKilcCiAgICAgICAgICB8KD86KFxcZHxcXFcpKy4qW2Etel0uKltB\
LVpdLiopfCg/OihcXGR8XFxXKSsuKltBLVpdKy4qW2Etel0rLiopXAogICAgICAgICAgfCg/OltB\
LVpdKy4qKFxcZHxcXFcpKy4qW2Etel0rLiopfCg/OlthLXpdKy4qKFxcZHxcXFcpKy4qW0EtWl0r\
LiopXAogICAgICAgICAgfCg/OlxcZCsuKlxcVysuKihbQS1aXXxbYS16XSkrLiopfCg/OlxcVysu\
KlxcZCsuKihbQS1aXXxbYS16XSkrLiopXAogICAgICAgICAgfCg/OihbQS1aXXxbYS16XSkrLipc\
XGQrLipcXFcrLiopfCg/OihbQS1aXXxbYS16XSkrLipcXFcrLipcXGQrLiopXAogICAgICAgICAg\
fCg/OlxcVysuKihbQS1aXXxbYS16XSkrLipcXGQrLiopfCg/OlxcZCsuKihbQS1aXXxbYS16XSkr\
LipcXFcrLiopKSQiCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGlzcGxheV90eXBlOiBw\
YXNzd29yZAogICAgICAgIHRpdGxlOiAiUGFzc3dvcmQgZm9yIHRoZSBkYXRhYmFzZSBhZG1pbiAo\
U0EpIHVzZXIuIgogICAgICAgIGRlc2NyaXB0aW9uOgogICAgICAgICAgIlRoZSBwYXNzd29yZCBt\
dXN0IGJlIGF0IGxlYXN0IDggY2hhcmFjdGVycyBsb25nIGFuZCBjb250YWluCiAgICAgICAgICBj\
aGFyYWN0ZXJzIGZyb20gdGhyZWUgb2YgdGhlIGZvbGxvd2luZyBmb3VyIHNldHM6IFVwcGVyY2Fz\
ZQogICAgICAgICAgbGV0dGVycywgTG93ZXJjYXNlIGxldHRlcnMsIEJhc2UgMTAgZGlnaXRzLCBh\
bmQgU3ltYm9scy4gWW91CiAgICAgICAgICBjYW4gZXhhbWluZSB0aGUgZXJyb3IgbG9nIGJ5IGV4\
ZWN1dGluZyB0aGUgZG9ja2VyIGxvZ3MgY29tbWFuZC4iCiAgICAgICAgZGlzcGxheV9ncm91cDog\
TVMgU1FMIENvbmZpZwogICAgICAgIG1pbl9sZW5ndGg6IDgKICAgICAgICBtYXhfbGVuZ3RoOiAx\
MjgKICAgICAgLSBuYW1lOiBNU1NRTF9EQVRBQkFTRQogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAg\
ICAgICAgZGVmYXVsdDogc2FtcGxlZGIKICAgICAgICBwYXR0ZXJuOiAiXlthLXpBLVowLTlfLV0q\
JCIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTogTmFtZSBvZiB0aGUgTVMgU1FM\
IGRhdGFiYXNlIGFjY2Vzc2VkCiAgICAgICAgZGlzcGxheV9ncm91cDogTVMgU1FMIENvbmZpZwog\
ICAgICAtIG5hbWU6IE1TU1FMX01FTU9SWV9MSU1JVAogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAg\
ICAgICAgZGVmYXVsdDogMgogICAgICAgIHR5cGU6IGludGVnZXIKICAgICAgICB0aXRsZToKICAg\
ICAgICAgIE1heGltdW0gYW1vdW50IG9mIG1lbW9yeSB0aGUgY29udGFpbmVyIGNhbiB1c2UgKGlu\
IEdpKSBlZyA1MTJNaSAxR2kKICAgICAgICBkaXNwbGF5X2dyb3VwOiBFbnZpcm9ubWVudCBTaXpp\
bmcKICAgICAgLSBuYW1lOiBNU1NRTF9NRU1PUllfUkVRVUVTVAogICAgICAgIHJlcXVpcmVkOiB0\
cnVlCiAgICAgICAgZGVmYXVsdDogMQogICAgICAgIHR5cGU6IGludGVnZXIKICAgICAgICB0aXRs\
ZToKICAgICAgICAgIFJlcXVlc3RlZCBhbW91bnQgb2YgbWVtb3J5IGZvciB0aGUgY29udGFpbmVy\
IHRvIHN0YXJ0IChpbiBHaSkKICAgICAgICAgIGVnIDFHaSAyR2kKICAgICAgICBkaXNwbGF5X2dy\
b3VwOiBFbnZpcm9ubWVudCBTaXppbmcKCiAgLSBuYW1lOiBwZXJzaXN0ZW50CiAgICBkZXNjcmlw\
dGlvbjogVGhpcyBwbGFuIGRlcGxveXMgYSBwZXJzaXN0ZW50IE1TIFNRTCBTZXJ2ZXIuCiAgICBm\
cmVlOiB0cnVlCiAgICBkZWZhdWx0OiBmYWxzZQogICAgbWV0YWRhdGE6CiAgICAgIGRpc3BsYXlO\
YW1lOiBQZXJzaXN0ZW50IGluc3RhbGxhdGlvbgogICAgICBsb25nRGVzY3JpcHRpb246CiAgICAg\
ICAgVGhpcyBwbGFuIHdpbGwgZGVwbG95IGEgc3RhbmRhbG9uZSBNUyBTUUwgU2VydmVyIG9uIExp\
bnV4CiAgICAgICAgdXNpbmcgcGVyc2lzdGVudCBzdG9yYWdlCiAgICBwYXJhbWV0ZXJzOgogICAg\
ICAtIG5hbWU6IE1TU1FMX1BBU1NXT1JECiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBk\
ZWZhdWx0OiAiSGVsbG8xMjMhIgogICAgICAgIHBhdHRlcm46ICJeKD86KD86W2Etel0rLipbQS1a\
XSsuKihcXGR8XFxXKSsuKilcCiAgICAgICAgICB8KD86W0EtWl0rLipbYS16XSsuKihcXGR8XFxX\
KSsuKilcCiAgICAgICAgICB8KD86KFxcZHxcXFcpKy4qW2Etel0uKltBLVpdLiopfCg/OihcXGR8\
XFxXKSsuKltBLVpdKy4qW2Etel0rLiopXAogICAgICAgICAgfCg/OltBLVpdKy4qKFxcZHxcXFcp\
Ky4qW2Etel0rLiopfCg/OlthLXpdKy4qKFxcZHxcXFcpKy4qW0EtWl0rLiopXAogICAgICAgICAg\
fCg/OlxcZCsuKlxcVysuKihbQS1aXXxbYS16XSkrLiopfCg/OlxcVysuKlxcZCsuKihbQS1aXXxb\
YS16XSkrLiopXAogICAgICAgICAgfCg/OihbQS1aXXxbYS16XSkrLipcXGQrLipcXFcrLiopfCg/\
OihbQS1aXXxbYS16XSkrLipcXFcrLipcXGQrLiopXAogICAgICAgICAgfCg/OlxcVysuKihbQS1a\
XXxbYS16XSkrLipcXGQrLiopfCg/OlxcZCsuKihbQS1aXXxbYS16XSkrLipcXFcrLiopKSQiCiAg\
ICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICAg\
IHRpdGxlOiAiUGFzc3dvcmQgZm9yIHRoZSBkYXRhYmFzZSBhZG1pbiAoU0EpIHVzZXIuIgogICAg\
ICAgIGRlc2NyaXB0aW9uOgogICAgICAgICAgIlRoZSBwYXNzd29yZCBtdXN0IGJlIGF0IGxlYXN0\
IDggY2hhcmFjdGVycyBsb25nIGFuZCBjb250YWluCiAgICAgICAgICBjaGFyYWN0ZXJzIGZyb20g\
dGhyZWUgb2YgdGhlIGZvbGxvd2luZyBmb3VyIHNldHM6IFVwcGVyY2FzZQogICAgICAgICAgbGV0\
dGVycywgTG93ZXJjYXNlIGxldHRlcnMsIEJhc2UgMTAgZGlnaXRzLCBhbmQgU3ltYm9scy4gWW91\
CiAgICAgICAgICBjYW4gZXhhbWluZSB0aGUgZXJyb3IgbG9nIGJ5IGV4ZWN1dGluZyB0aGUgZG9j\
a2VyIGxvZ3MgY29tbWFuZC4iCiAgICAgICAgZGlzcGxheV9ncm91cDogTVMgU1FMIENvbmZpZwog\
ICAgICAgIG1pbl9sZW5ndGg6IDgKICAgICAgICBtYXhfbGVuZ3RoOiAxMjgKICAgICAgLSBuYW1l\
OiBNU1NRTF9EQVRBQkFTRQogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDog\
c2FtcGxlZGIKICAgICAgICBwYXR0ZXJuOiAiXlthLXpBLVowLTlfLV0qJCIKICAgICAgICB0eXBl\
OiBzdHJpbmcKICAgICAgICB0aXRsZTogTmFtZSBvZiB0aGUgTVMgU1FMIGRhdGFiYXNlIGFjY2Vz\
c2VkCiAgICAgICAgZGlzcGxheV9ncm91cDogTVMgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1T\
U1FMX0RBVEFfU1RPUkFHRV9TSVpFCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZh\
dWx0OiAxCiAgICAgICAgdHlwZTogaW50ZWdlcgogICAgICAgIHRpdGxlOiBQZXJzaXN0ZW50IHZv\
bHVtZSBzaXplIGZvciBkYiBkYXRhIChpbiBHaSkgZWcgNTEyTWkgMUdpCiAgICAgICAgZGlzcGxh\
eV9ncm91cDogRW52aXJvbm1lbnQgU2l6aW5nCiAgICAgIC0gbmFtZTogTVNTUUxfTUVNT1JZX0xJ\
TUlUCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiAzCiAgICAgICAgdHlw\
ZTogaW50ZWdlcgogICAgICAgIHRpdGxlOgogICAgICAgICAgTWF4aW11bSBhbW91bnQgb2YgbWVt\
b3J5IHRoZSBjb250YWluZXIgY2FuIHVzZSAoaW4gR2kpIGVnIDUxMk1pIDFHaQogICAgICAgIGRp\
c3BsYXlfZ3JvdXA6IEVudmlyb25tZW50IFNpemluZwogICAgICAtIG5hbWU6IE1TU1FMX01FTU9S\
WV9SRVFVRVNUCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiAyCiAgICAg\
ICAgdHlwZTogaW50ZWdlcgogICAgICAgIHRpdGxlOgogICAgICAgICAgUmVxdWVzdGVkIGFtb3Vu\
dCBvZiBtZW1vcnkgZm9yIHRoZSBjb250YWluZXIgdG8gc3RhcnQgKGluIEdpKQogICAgICAgICAg\
ZWcgMUdpIDJHaQogICAgICAgIGRpc3BsYXlfZ3JvdXA6IEVudmlyb25tZW50IFNpemluZwo="



COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN yum -y install --setopt=tsflags=nodocs python-pip && \
    yum clean all && \
    chown -R 0 /opt/{ansible,apb} && \
    pip install --upgrade pip && \
    pip install pymssql && \
    chown -R apb:0 /opt/{ansible,apb} && \
    chmod -R g=u /opt/{ansible,apb}
USER apb
