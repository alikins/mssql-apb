FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"LS0tCnZlcnNpb246IDEuMApuYW1lOiBtc3NxbC1hcGIKZGVzY3JpcHRpb246IEFQQiB0byBkZXBs\
b3kgTWljcm9zb2Z0IFNRTCBTZXJ2ZXIgb24gTGludXggMjAxNyBEZXZlbG9wZXIgRWRpdGlvbgpi\
aW5kYWJsZTogdHJ1ZQphc3luYzogb3B0aW9uYWwKbWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6IE1T\
IFNRTCBTZXJ2ZXIgb24gTGludXggKEFQQikKICBpbWFnZVVybDoKICAgIGh0dHBzOi8vcmF3Lmdp\
dGh1YnVzZXJjb250ZW50LmNvbS9hbnNpYmxlcGxheWJvb2tidW5kbGUvbXNzcWwtYXBiL21hc3Rl\
ci9kb2NzL2ltZy9zcWwtc2VydmVyLnBuZwogIGRvY3VtZW50YXRpb25Vcmw6CiAgICBodHRwczov\
L2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9zcWwvbGludXgvc3FsLXNlcnZlci1saW51eC1vdmVy\
dmlldwogIGRlcGVuZGVuY2llczogWydkb2NrZXIuaW8vdGNodWdoZXNpdi9tc3NxbC1zZXJ2ZXIt\
bGludXgnXQp0YWdzOgogIC0gZGF0YWJhc2UKICAtIG1zc3FsCnBsYW5zOgogIC0gbmFtZTogZXBo\
ZW1lcmFsCiAgICBkZXNjcmlwdGlvbjogVGhpcyBwbGFuIGRlcGxveXMgYW4gZXBoZW1lcmFsIE1T\
IFNRTCBTZXJ2ZXIuCiAgICBmcmVlOiB0cnVlCiAgICBkZWZhdWx0OiB0cnVlCiAgICBtZXRhZGF0\
YToKICAgICAgZGlzcGxheU5hbWU6IEVwaGVtZXJhbCBpbnN0YWxsYXRpb24KICAgICAgbG9uZ0Rl\
c2NyaXB0aW9uOgogICAgICAgIFRoaXMgcGxhbiB3aWxsIGRlcGxveSBhIHN0YW5kYWxvbmUgTVMg\
U1FMIFNlcnZlciBvbiBMaW51eAogICAgICAgIHVzaW5nIGVwaGVtZXJhbCBzdG9yYWdlCiAgICBw\
YXJhbWV0ZXJzOgogICAgICAtIG5hbWU6IE1TU1FMX1BBU1NXT1JECiAgICAgICAgcmVxdWlyZWQ6\
IHRydWUKICAgICAgICBkZWZhdWx0OiAiSGVsbG8xMjMhIgogICAgICAgIHBhdHRlcm46ICJeKD86\
KD86W2Etel0rLipbQS1aXSsuKihcXGR8XFxXKSsuKilcCiAgICAgICAgICB8KD86W0EtWl0rLipb\
YS16XSsuKihcXGR8XFxXKSsuKilcCiAgICAgICAgICB8KD86KFxcZHxcXFcpKy4qW2Etel0uKltB\
LVpdLiopfCg/OihcXGR8XFxXKSsuKltBLVpdKy4qW2Etel0rLiopXAogICAgICAgICAgfCg/OltB\
LVpdKy4qKFxcZHxcXFcpKy4qW2Etel0rLiopfCg/OlthLXpdKy4qKFxcZHxcXFcpKy4qW0EtWl0r\
LiopXAogICAgICAgICAgfCg/OlxcZCsuKlxcVysuKihbQS1aXXxbYS16XSkrLiopfCg/OlxcVysu\
KlxcZCsuKihbQS1aXXxbYS16XSkrLiopXAogICAgICAgICAgfCg/OihbQS1aXXxbYS16XSkrLipc\
XGQrLipcXFcrLiopfCg/OihbQS1aXXxbYS16XSkrLipcXFcrLipcXGQrLiopXAogICAgICAgICAg\
fCg/OlxcVysuKihbQS1aXXxbYS16XSkrLipcXGQrLiopfCg/OlxcZCsuKihbQS1aXXxbYS16XSkr\
LipcXFcrLiopKSQiCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGlzcGxheV90eXBlOiBw\
YXNzd29yZAogICAgICAgIHRpdGxlOiAiUGFzc3dvcmQgZm9yIHRoZSBkYXRhYmFzZSBhZG1pbiAo\
U0EpIHVzZXIuIgogICAgICAgIGRlc2NyaXB0aW9uOgogICAgICAgICAgIlRoZSBwYXNzd29yZCBt\
dXN0IGJlIGF0IGxlYXN0IDggY2hhcmFjdGVycyBsb25nIGFuZCBjb250YWluCiAgICAgICAgICBj\
aGFyYWN0ZXJzIGZyb20gdGhyZWUgb2YgdGhlIGZvbGxvd2luZyBmb3VyIHNldHM6IFVwcGVyY2Fz\
ZQogICAgICAgICAgbGV0dGVycywgTG93ZXJjYXNlIGxldHRlcnMsIEJhc2UgMTAgZGlnaXRzLCBh\
bmQgU3ltYm9scy4iCiAgICAgICAgZGlzcGxheV9ncm91cDogTVMgU1FMIENvbmZpZwogICAgICAg\
IG1pbl9sZW5ndGg6IDgKICAgICAgICBtYXhfbGVuZ3RoOiAxMjgKICAgICAgLSBuYW1lOiBNU1NR\
TF9EQVRBQkFTRQogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogc2FtcGxl\
ZGIKICAgICAgICBwYXR0ZXJuOiAiXlthLXpBLVowLTlfLV0qJCIKICAgICAgICB0eXBlOiBzdHJp\
bmcKICAgICAgICB0aXRsZTogTmFtZSBvZiB0aGUgTVMgU1FMIGRhdGFiYXNlIGFjY2Vzc2VkCiAg\
ICAgICAgZGlzcGxheV9ncm91cDogTVMgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1TU1FMX01F\
TU9SWV9MSU1JVAogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogMwogICAg\
ICAgIHR5cGU6IGludGVnZXIKICAgICAgICB0aXRsZToKICAgICAgICAgIE1heGltdW0gYW1vdW50\
IG9mIG1lbW9yeSB0aGUgY29udGFpbmVyIGNhbiB1c2UgKGluIEdpKSBlZyAxR2kgMkdpCiAgICAg\
ICAgZGlzcGxheV9ncm91cDogRW52aXJvbm1lbnQgU2l6aW5nCiAgICAgIC0gbmFtZTogTVNTUUxf\
TUVNT1JZX1JFUVVFU1QKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IDIK\
ICAgICAgICB0eXBlOiBpbnRlZ2VyCiAgICAgICAgdGl0bGU6CiAgICAgICAgICBSZXF1ZXN0ZWQg\
YW1vdW50IG9mIG1lbW9yeSBmb3IgdGhlIGNvbnRhaW5lciB0byBzdGFydCAoaW4gR2kpCiAgICAg\
ICAgICBlZyAxR2kgMkdpCiAgICAgICAgZGlzcGxheV9ncm91cDogRW52aXJvbm1lbnQgU2l6aW5n\
CiAgLSBuYW1lOiBwZXJzaXN0ZW50CiAgICBkZXNjcmlwdGlvbjogVGhpcyBwbGFuIGRlcGxveXMg\
YSBwZXJzaXN0ZW50IE1TIFNRTCBTZXJ2ZXIuCiAgICBmcmVlOiB0cnVlCiAgICBtZXRhZGF0YToK\
ICAgICAgZGlzcGxheU5hbWU6IFBlcnNpc3RlbnQgaW5zdGFsbGF0aW9uCiAgICAgIGxvbmdEZXNj\
cmlwdGlvbjoKICAgICAgICBUaGlzIHBsYW4gd2lsbCBkZXBsb3kgYSBzdGFuZGFsb25lIE1TIFNR\
TCBTZXJ2ZXIgb24gTGludXgKICAgICAgICB1c2luZyBwZXJzaXN0ZW50IHN0b3JhZ2UKICAgIHBh\
cmFtZXRlcnM6CiAgICAgIC0gbmFtZTogTVNTUUxfUEFTU1dPUkQKICAgICAgICByZXF1aXJlZDog\
dHJ1ZQogICAgICAgIGRlZmF1bHQ6ICJIZWxsbzEyMyEiCiAgICAgICAgcGF0dGVybjogIl4oPzoo\
PzpbYS16XSsuKltBLVpdKy4qKFxcZHxcXFcpKy4qKVwKICAgICAgICAgIHwoPzpbQS1aXSsuKlth\
LXpdKy4qKFxcZHxcXFcpKy4qKVwKICAgICAgICAgIHwoPzooXFxkfFxcVykrLipbYS16XS4qW0Et\
Wl0uKil8KD86KFxcZHxcXFcpKy4qW0EtWl0rLipbYS16XSsuKilcCiAgICAgICAgICB8KD86W0Et\
Wl0rLiooXFxkfFxcVykrLipbYS16XSsuKil8KD86W2Etel0rLiooXFxkfFxcVykrLipbQS1aXSsu\
KilcCiAgICAgICAgICB8KD86XFxkKy4qXFxXKy4qKFtBLVpdfFthLXpdKSsuKil8KD86XFxXKy4q\
XFxkKy4qKFtBLVpdfFthLXpdKSsuKilcCiAgICAgICAgICB8KD86KFtBLVpdfFthLXpdKSsuKlxc\
ZCsuKlxcVysuKil8KD86KFtBLVpdfFthLXpdKSsuKlxcVysuKlxcZCsuKilcCiAgICAgICAgICB8\
KD86XFxXKy4qKFtBLVpdfFthLXpdKSsuKlxcZCsuKil8KD86XFxkKy4qKFtBLVpdfFthLXpdKSsu\
KlxcVysuKikpJCIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICBkaXNwbGF5X3R5cGU6IHBh\
c3N3b3JkCiAgICAgICAgdGl0bGU6ICJQYXNzd29yZCBmb3IgdGhlIGRhdGFiYXNlIGFkbWluIChT\
QSkgdXNlci4iCiAgICAgICAgZGVzY3JpcHRpb246CiAgICAgICAgICAiVGhlIHBhc3N3b3JkIG11\
c3QgYmUgYXQgbGVhc3QgOCBjaGFyYWN0ZXJzIGxvbmcgYW5kIGNvbnRhaW4KICAgICAgICAgIGNo\
YXJhY3RlcnMgZnJvbSB0aHJlZSBvZiB0aGUgZm9sbG93aW5nIGZvdXIgc2V0czogVXBwZXJjYXNl\
CiAgICAgICAgICBsZXR0ZXJzLCBMb3dlcmNhc2UgbGV0dGVycywgQmFzZSAxMCBkaWdpdHMsIGFu\
ZCBTeW1ib2xzLiIKICAgICAgICBkaXNwbGF5X2dyb3VwOiBNUyBTUUwgQ29uZmlnCiAgICAgICAg\
bWluX2xlbmd0aDogOAogICAgICAgIG1heF9sZW5ndGg6IDEyOAogICAgICAtIG5hbWU6IE1TU1FM\
X0RBVEFCQVNFCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiBzYW1wbGVk\
YgogICAgICAgIHBhdHRlcm46ICJeW2EtekEtWjAtOV8tXSokIgogICAgICAgIHR5cGU6IHN0cmlu\
ZwogICAgICAgIHRpdGxlOiBOYW1lIG9mIHRoZSBNUyBTUUwgZGF0YWJhc2UgYWNjZXNzZWQKICAg\
ICAgICBkaXNwbGF5X2dyb3VwOiBNUyBTUUwgQ29uZmlnCiAgICAgIC0gbmFtZTogTVNTUUxfREFU\
QV9TVE9SQUdFX1NJWkUKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IDEK\
ICAgICAgICB0eXBlOiBpbnRlZ2VyCiAgICAgICAgdGl0bGU6IFBlcnNpc3RlbnQgdm9sdW1lIHNp\
emUgZm9yIGRiIGRhdGEgKGluIEdpKSBlZyAxR2kgMkdpCiAgICAgICAgZGlzcGxheV9ncm91cDog\
RW52aXJvbm1lbnQgU2l6aW5nCiAgICAgIC0gbmFtZTogTVNTUUxfTUVNT1JZX0xJTUlUCiAgICAg\
ICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiAzCiAgICAgICAgdHlwZTogaW50ZWdl\
cgogICAgICAgIHRpdGxlOgogICAgICAgICAgTWF4aW11bSBhbW91bnQgb2YgbWVtb3J5IHRoZSBj\
b250YWluZXIgY2FuIHVzZSAoaW4gR2kpIGVnIDFHaSAyR2kKICAgICAgICBkaXNwbGF5X2dyb3Vw\
OiBFbnZpcm9ubWVudCBTaXppbmcKICAgICAgLSBuYW1lOiBNU1NRTF9NRU1PUllfUkVRVUVTVAog\
ICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogMgogICAgICAgIHR5cGU6IGlu\
dGVnZXIKICAgICAgICB0aXRsZToKICAgICAgICAgIFJlcXVlc3RlZCBhbW91bnQgb2YgbWVtb3J5\
IGZvciB0aGUgY29udGFpbmVyIHRvIHN0YXJ0IChpbiBHaSkKICAgICAgICAgIGVnIDFHaSAyR2kK\
ICAgICAgICBkaXNwbGF5X2dyb3VwOiBFbnZpcm9ubWVudCBTaXppbmcK"



COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN yum -y install --setopt=tsflags=nodocs python-pip && \
    yum clean all && \
    chown -R 0 /opt/{ansible,apb} && \
    pip install --upgrade pip && \
    pip install pymssql && \
    chown -R apb:0 /opt/{ansible,apb} && \
    chmod -R g=u /opt/{ansible,apb}
USER apb
